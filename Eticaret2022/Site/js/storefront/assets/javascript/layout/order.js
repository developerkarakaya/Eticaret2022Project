;(function($,w){'use strict';if(!w.$){throw 'Ideasoft: $ not found';}
w.IdeaApp[IdeaApp.helpers.getRouteGroup()]={init:function(){IdeaApp.helpers.initializePage();this.eventListener();},customPlaceholder:{click:function(element){if(element.attr('disabled')=='disabled'){return;}
if(!element.parent().hasClass('active')){element.parent().addClass('active');}},focus:function(element){if(element.val()==''){element.parent().removeClass('focused');}else{element.parent().addClass('focused');}},removeClass:function(event,className){var target=$(event.target),targetClass=className;if(target.prev().attr('disabled')=='disabled'){return;}
if(target.hasClass('targetClass')||target.parents().hasClass(targetClass)){$('.'+targetClass).removeClass('active');$(target).parents('.'+targetClass).addClass('active');}else{$('.'+targetClass).removeClass('active');}}},toggleCartItems:function(element){if(element.hasClass('active')){$('#cart-items').stop().slideUp();element.removeClass('active').find('i').removeClass('fa-caret-up').addClass('fa-caret-down');}else{$('#cart-items').stop().slideDown();element.addClass('active').find('i').removeClass('fa-caret-down').addClass('fa-caret-up');}},returnCartPage:function(){IdeaApp.plugins.confirmDialog('Ürünleri düzenlemek için Sepet Sayfasına yönlendirileceksiniz.',function(){window.location='/sepet';});},step2:{autoFill:false,init:function(){this.addressValidate();this.phoneMask();this.memberAddress.init();this.eventListener();this.setDefaultShippingCountry();this.loadLocationShippingCountryAbroad();},autoFillForm:{init:function(element){element.addClass('btn-loading').attr('disabled','disabled');IdeaApp.order.step2.autoFill=true;IdeaApp.helpers.unMask([$('input[name="phoneNumber"]'),$('input[name="mobilePhoneNumber"]'),$('input[name="billingPhoneNumber"]'),$('input[name="billingMobilePhoneNumber"]')]);this.setAddressTitle();this.setEmail();this.setFirstName();this.setLastName();this.setPhoneNumber();this.setMobilePhoneNumber();this.setCountry();this.setIdentityRegistrationNumber();this.setCommercialName();this.setTaxNumber();this.setTaxOffice();this.setAddress();this.setDeliveryDate();this.setDeliveryTime();this.refreshCustomPlaceHolder(element);},setAddressTitle:function(){$('[name="title"]').val('Adres Başlığı');},setEmail:function(){$('[name="email"]').val('test@test.com.tr');},setFirstName:function(){$('[name="firstname"], [name="billingFirstname"]').val("Yazılım");},setLastName:function(){$('[name="surname"], [name="billingSurname"]').val("Ekibi");},setCountry:function(){if($('[name="country"] option:nth-child(2)').length>0){$('[name="country"] option:nth-child(2), [name="billingCountry"] option:nth-child(2)').prop('selected',true).change();this.setLocation();}else{this.setCargoDetail();}},setLocation:function(){if($('[name="location"] option:nth-child(2)').length>0){var optionCount=$('[name="location"] option').length;var index=Math.floor(Math.random()*optionCount)+1;$('[name="location"] option:nth-child('+index+'), [name="billingLocation"] option:nth-child('+index+')').prop('selected',true).change();}else{$('[name="location"], [name="billingLocation"]').val(this.generateRandomString(15));}
this.setSubLocation();this.setCargoDetail();},setSubLocation:function(){if($('[name="subLocation"] option:nth-child(2)').length>0){$('[name="subLocation"] option:nth-child(2), [name="billingSubLocation"] option:nth-child(2)').prop('selected',true).change();}else{$('[name="subLocation"], [name="billingSubLocation"]').val(this.generateRandomString(15));}},setPhoneNumber:function(){$('[name="phoneNumber"], [name="billingPhoneNumber"]').val("90212"+Math.floor(Math.random()*9000)+1000);},setMobilePhoneNumber:function(){$('[name="mobilePhoneNumber"], [name="billingMobilePhoneNumber"]').val("90532"+Math.floor(Math.random()*9000)+1000);},setIdentityRegistrationNumber:function(){var digits=[];var identityRegistrationNumber;digits[0]=this.generateRandomNumber(1,9);for(var i=1;i<9;i++){digits[i]=this.generateRandomNumber(0,9);}
digits[9]=((digits[0]+digits[2]+digits[4]+digits[6]+digits[8])*7-(digits[1]+digits[3]+digits[5]+digits[7]))%10;digits[10]=(digits[0]+digits[1]+digits[2]+digits[3]+digits[4]+digits[5]+digits[6]+digits[7]+digits[8]+digits[9])%10;identityRegistrationNumber=digits[0].toString()+digits[1].toString()+digits[2].toString()+digits[3].toString()+digits[4].toString()+digits[5].toString()+digits[6].toString()+digits[7].toString()+digits[8].toString()+digits[9].toString()+digits[10].toString();$('[name="shippingIdentityRegistrationNumber"]').val(identityRegistrationNumber);$('[name="billingIdentityRegistrationNumber"]').val(identityRegistrationNumber);},setTaxNumber:function(){$('[name="taxNumber"]').val('9088449661');},setTaxOffice:function(){$('[name="taxOffice"]').val('Vergi Dairesi');},setCommercialName:function(){$('[name="commercialName"]').val('Yazılım Ekibi');},setAddress:function(){$('[name="address"], [name="billingAddress"]').val("Deneme siparişidir KESİNLİKLE KARGOLAMAYINIZ.");},setCargoDetail:function(){$('input:radio[name="shippingCompanyId"]:first').click();$('.checkout-cargo-details-content').removeClass('cart-block-error');},setDeliveryDate:function(){var date=new Date();var year=date.getFullYear();var month=(1+date.getMonth()).toString();month=month.length>1?month:'0'+month;var day=date.getDate().toString();day=day.length>1?day:'0'+day;$('[name="deliveryDate"]').val(day+'/'+month+'/'+year);},setDeliveryTime:function(){$('[name="deliveryTime"] option:nth-child(2)').prop('selected',true);},generateRandomNumber:function(min,max){return Math.floor(Math.random()*(max-min+1))+min;},generateRandomString:function(length){return Math.random().toString(length).slice(2);},refreshCustomPlaceHolder:function(buttonElement){IdeaApp.order.step2.autoFill=false;$(".custom-placeholder").addClass('focused');$('div.validate-error').remove();$('.validate-error').each(function(){$(this).removeClass('validate-error');});setTimeout(function(){buttonElement.removeClass('btn-loading').removeAttr('disabled');},500);}},addressValidate:function(){$('#step2Form, #addAddressForm, #editAddressForm').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',focusInvalid:false,rules:{email:{required:true,email:{depends:function(){$(this).val($.trim($(this).val()));return true;}},maxlength:255},title:{required:true,minlength:2,maxlength:255},firstname:{required:true,minlength:2,maxlength:255},surname:{required:true,minlength:2,maxlength:255},phoneNumber:{phoneValid:true,minlength:7},mobilePhoneNumber:{required:true,phoneValid:true,minlength:7},shippingIdentityRegistrationNumber:{required:true,maxlength:11,tcNo:true},billingIdentityRegistrationNumber:{required:true,maxlength:11,tcNo:true},country:{required:true},location:{required:true},subLocation:{required:true},address:{required:true,minlength:5,maxlength:255},commercialName:{required:true,minlength:2,maxlength:255},taxNumber:{required:true,maxlength:{depends:function(){if($('#differentBillingAddress').is(':checked')){var billingCountryElement=jQuery('select[name="billingCountry"]');if(billingCountryElement.val()!=1){return false;}}
var countryElement=jQuery('select[name="country"]');if(countryElement.val()!=1){return false;}
if($(this).val().length<=11){return false;}
return true;}},taxNumber:true,},taxOffice:{required:true,minlength:2,maxlength:255},billingFirstname:{required:true,minlength:2,maxlength:255},billingSurname:{required:true,minlength:2,maxlength:255},billingPhoneNumber:{phoneValid:true,minlength:7},billingMobilePhoneNumber:{required:true,phoneValid:true,minlength:7},billingCountry:{required:true},billingLocation:{required:true},billingSubLocation:{required:true},billingAddress:{required:true,minlength:5,maxlength:255},shippingCompanyId:{required:true},deliveryDate:{required:true},deliveryTime:{required:true}},messages:{email:{required:"Lütfen "+getFormValidateMessage('input[name="email"]')+" giriniz.",email:""+getFormValidateMessage('input[name="email"]')+" uygun formatta olmalıdır."},title:{required:"Lütfen "+getFormValidateMessage('input[name="title"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="title"]')+" en az 2 karakter olmalıdır.",maxlength:""+getFormValidateMessage('input[name="title"]')+" en fazla 255 karakter olmalıdır."},firstname:{required:"Lütfen "+getFormValidateMessage('input[name="firstname"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="firstname"]')+" en az 2 karakter olmalıdır.",maxlength:""+getFormValidateMessage('input[name="firstname"]')+" en fazla 255 karakter olmalıdır."},surname:{required:"Lütfen "+getFormValidateMessage('input[name="surname"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="surname"]')+" en az 2 karakter olmalıdır.",maxlength:""+getFormValidateMessage('input[name="surname"]')+" en fazla 255 karakter olmalıdır."},phoneNumber:{phoneValid:"Lütfen geçerli bir "+getFormValidateMessage('input[name="phoneNumber"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="phoneNumber"]')+" en az 7 karakter olmalıdır."},mobilePhoneNumber:{required:"Lütfen "+getFormValidateMessage('input[name="mobilePhoneNumber"]')+" giriniz.",phoneValid:"Geçerli bir "+getFormValidateMessage('input[name="mobilePhoneNumber"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="mobilePhoneNumber"]')+" en az 7 karakter olmalıdır."},shippingIdentityRegistrationNumber:{required:"Lütfen "+getFormValidateMessage('input[name="shippingIdentityRegistrationNumber"]')+" giriniz.",maxlength:""+getFormValidateMessage('input[name="shippingIdentityRegistrationNumber"]')+" en fazla 7 karakter olmalıdır.",tcNo:"Lütfen geçerli bir "+getFormValidateMessage('input[name="shippingIdentityRegistrationNumber"]')+" giriniz."},billingIdentityRegistrationNumber:{required:"Lütfen "+getFormValidateMessage('input[name="billingIdentityRegistrationNumber"]')+" giriniz.",maxlength:""+getFormValidateMessage('input[name="billingIdentityRegistrationNumber"]')+" en fazla 7 karakter olmalıdır.",tcNo:"Lütfen geçerli bir "+getFormValidateMessage('input[name="billingIdentityRegistrationNumber"]')+" giriniz."},country:{required:"Lütfen "+getFormValidateMessage('select[name="country"]')+" seçiniz."},location:{required:"Lütfen "+getFormValidateMessage('[name="location"]')+" seçiniz."},subLocation:{required:"Lütfen "+getFormValidateMessage('[name="subLocation"]')+" seçiniz."},address:{required:"Lütfen "+getFormValidateMessage('textarea[name="address"]')+" giriniz.",minlength:""+getFormValidateMessage('textarea[name="address"]')+" en az 5 karakter olmalıdır.",maxlength:""+getFormValidateMessage('textarea[name="address"]')+" en fazla 255 karakter olmalıdır."},commercialName:{required:"Lütfen "+getFormValidateMessage('input[name="commercialName"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="commercialName"]')+" en az 2 karakter olmalıdır.",maxlength:""+getFormValidateMessage('input[name="commercialName"]')+" en fazla 255 karakter olmalıdır."},taxNumber:{required:"Lütfen "+getFormValidateMessage('input[name="taxNumber"]')+" giriniz.",maxlength:""+getFormValidateMessage('input[name="taxNumber"]')+" en fazla 11 karakter olmalıdır.",taxNumber:"Lütfen geçerli bir "+getFormValidateMessage('input[name="taxNumber"]')+" giriniz."},taxOffice:{required:"Lütfen "+getFormValidateMessage('input[name="taxOffice"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="taxOffice"]')+" en az 2 karakter olmalıdır.",maxlength:""+getFormValidateMessage('input[name="taxOffice"]')+" en fazla 255 karakter olmalıdır."},billingFirstname:{required:"Lütfen "+getFormValidateMessage('input[name="billingFirstname"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="billingFirstname"]')+" en az 2 karakter olmalıdır.",maxlength:""+getFormValidateMessage('input[name="billingFirstname"]')+" en fazla 255 karakter olmalıdır."},billingSurname:{required:"Lütfen "+getFormValidateMessage('input[name="billingSurname"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="billingSurname"]')+" en az 2 karakter olmalıdır.",maxlength:""+getFormValidateMessage('input[name="billingSurname"]')+" en fazla 255 karakter olmalıdır."},billingPhoneNumber:{phoneValid:"Lütfen geçerli bir "+getFormValidateMessage('input[name="billingPhoneNumber"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="billingPhoneNumber"]')+" en az 7 karakter olmalıdır."},billingMobilePhoneNumber:{required:"Lütfen "+getFormValidateMessage('input[name="billingMobilePhoneNumber"]')+" giriniz.",phoneValid:"Lütfen geçerli bir "+getFormValidateMessage('input[name="billingMobilePhoneNumber"]')+" giriniz.",minlength:""+getFormValidateMessage('input[name="billingMobilePhoneNumber"]')+" en az 7 karakter olmalıdır."},billingCountry:{required:"Lütfen "+getFormValidateMessage('select[name="billingCountry"]')+" seçiniz."},billingLocation:{required:"Lütfen "+getFormValidateMessage('[name="billingLocation"]')+" seçiniz."},billingSubLocation:{required:"Lütfen "+getFormValidateMessage('[name="billingSubLocation"]')+" seçiniz."},billingAddress:{required:"Lütfen "+getFormValidateMessage('textarea[name="billingAddress"]')+" giriniz.",minlength:""+getFormValidateMessage('textarea[name="billingAddress"]')+" en az 5 karakter olmalıdır.",maxlength:""+getFormValidateMessage('textarea[name="billingAddress"]')+" en fazla 255 karakter olmalıdır."},shippingCompanyId:{required:"Lütfen Kargo seçimi yapınız."},deliveryDate:{required:"Lütfen Teslimat Tarihi seçiniz."},deliveryTime:{required:"Lütfen Teslimat Saati seçiniz."}},invalidHandler:function(form,validator){if(!validator.numberOfInvalids()){return;}
$('html, body').animate({scrollTop:$(validator.errorList[0].element).parents('.cart-block').offset().top-10},200);},errorPlacement:function(error,element){if(element.attr("type")=="radio"){element.parents('.cart-block').append(error).addClass('cart-block-error');}else if(element.parents('.input-group').length!==0){element.parents('.input-group').after(error);}else{element.after(error);}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});function getFormValidateMessage(selector){return $.trim($(selector).eq(0).parents('.custom-placeholder').find('label').text());}
$('[data-required="0"]').each(function(){$(this).rules("remove","required");});$.validator.addMethod('email',function(email){return IdeaApp.helpers.checkEmail(email);});$.validator.addMethod('phoneValid',function(value,element){return IdeaApp.helpers.checkPhone(value,element);});$.validator.addMethod('tcNo',function(value,element){return IdeaApp.helpers.checkIdentityNumber(value,element);});$.validator.addMethod('taxNumber',function(value){return IdeaApp.helpers.checkTaxNumber(value);});},phoneMask:function(){if($('[name="country"]').val()==1){IdeaApp.helpers.maskPhone([$('input[name="phoneNumber"]'),$('input[name="mobilePhoneNumber"]')]);}else{IdeaApp.helpers.unMask([$('input[name="phoneNumber"]'),$('input[name="mobilePhoneNumber"]')]);}
if($('[name="billingCountry"]').val()==1){IdeaApp.helpers.maskPhone([$('input[name="billingPhoneNumber"]'),$('input[name="billingMobilePhoneNumber"]')]);}else{IdeaApp.helpers.unMask([$('input[name="billingPhoneNumber"]'),$('input[name="billingMobilePhoneNumber"]')]);}},toggleGiftNote:function(element){if(element.is(':checked')){$('#gift-note-area').stop().slideDown();}else{$('#gift-note-area').stop().slideUp();}},toggleBillingAddress:function(element){if(element.is(':checked')){if($("input[name='invoiceType']:checked").val()=='individual'){$('#billingIdentityRegistrationNumber').removeAttr('disabled');}
$('#billing-address-wrapper').stop().slideDown();}else{$('#shippingIdentityRegistrationNumber').removeAttr('disabled');$('#billingIdentityRegistrationNumber').attr('disabled','disabled');$('#billing-address-wrapper').stop().slideUp();}},getAddressType:function(element){var addressType='shipping';if(element.attr('id').indexOf('billing')!==-1){addressType='billing';}
return addressType;},loadLocations:function(element){var self=this;var countryId=parseInt(element.val());var addressType=self.getAddressType(element);var locationSelector=addressType+'Location';var subLocationSelector=addressType+'SubLocation';self.setLocationHtml(locationSelector,[]);self.setLocationHtml(subLocationSelector,[]);if(isNaN(countryId)){return;}
self.phoneMask();element.parents('.selectbox').addClass('selectbox-loading');IdeaApp.helpers.ajaxRequest({url:'/location/country-id/'+countryId,async:(self.autoFill?false:true),success:function(response){if(!response.success){return;}
self.setLocationHtml(locationSelector,response.data);element.parents('.selectbox').removeClass('selectbox-loading');}});},loadSubLocations:function(element){var self=this;var locationId=parseInt(element.val());var addressType=self.getAddressType(element);var subLocationSelector=addressType+'SubLocation';self.setLocationHtml(subLocationSelector,[]);if(!isMember&&addressType=='shipping'){self.loadShippingCompanies();self.loadCartSummary();}
if(isNaN(locationId)){return;}
element.parents('.selectbox').addClass('selectbox-loading');IdeaApp.helpers.ajaxRequest({url:'/town/location-id/'+locationId,async:(self.autoFill?false:true),success:function(response){if(!response.success){return;}
self.setLocationHtml(subLocationSelector,response.data);element.parents('.selectbox').removeClass('selectbox-loading');}});},setLocationHtml:function(locationSelector,locations){var output='';var locationElement=$('#'+locationSelector);if(locations.length===0){output+='\
                    <div class="custom-placeholder"> \
                        <input type="text" name="'+locationElement.attr('name')+'" id="'+locationElement.attr('id')+'"  class="form-control" /> \
                        <label for="'+locationElement.attr('id')+'" required="required"> \
                            '+locationElement.parent().find('label').text()+' \
                        </label> \
                    </div>';locationElement.parents('[data-selector="location-wrapper"]').html(output);return;}
output+='\
                    <div class="custom-placeholder selectbox select-placeholder"> \
                        <select name="'+locationElement.attr('name')+'" id="'+locationElement.attr('id')+'">\
                            <option value="">'+locationElement.next('label').text()+'</option>\
                        </select>\
                        <label for="'+locationElement.attr('id')+'" required="required"> \
                            '+locationElement.parent().find('label').text()+' \
                        </label> \
                    </div>';locationElement.parents('[data-selector="location-wrapper"]').html(output);$(locations).each(function(key,location){$('#'+locationSelector).append('<option value="'+location.id+'">'+location.name+'</option>');});},changeInvoiceType:function(invoiceType){if(invoiceType=='individual'){$('#corporate-wrapper').stop().slideUp();$('#fullname').stop().slideDown();$('#billingIdentityRegistrationNumber, #shippingIdentityRegistrationNumber').removeAttr('disabled');}else{var fullName='';if(isMember){fullName=$('input[name="firstname"]').val()+' '+$('input[name="surname"]').val();}else{fullName=$('input[name="billingFirstname"]').val()+' '+$('input[name="billingSurname"]').val();}
if($.trim(fullName).length>0){$('[name="commercialName"]').val(fullName).parent().addClass('focused');}
$('#corporate-wrapper').stop().slideDown();$('#fullname').stop().slideUp();$('#billingIdentityRegistrationNumber, #shippingIdentityRegistrationNumber').attr('disabled','disabled').removeClass('validate-error').next('.validate-error').remove();}},getShippingLocationId:function(){var shippingLocationId=parseInt($('#shippingLocation').val());var shippingAddressIdElement=$('input[name=shippingAddressId]');let shippingAddressId=parseInt(shippingAddressIdElement.val());if(isNaN(shippingLocationId)){shippingLocationId=parseInt($('[data-type="shipping-address-wrapper"] .address-block-header > div').attr('data-location-id'));}
if(isNaN(shippingLocationId)&&IdeaCart.sessionId!==null){if(typeof shippingAddressIdElement!=="undefined"&&shippingAddressIdElement!==null&&shippingAddressId>0){let shippingLocationIdByAddress=this.getShippingLocationIdByAddress();if(shippingLocationIdByAddress!==null){shippingLocationId=shippingLocationIdByAddress;}}else{var shippingLocationIdByCountry=this.getShippingLocationIdByCountry();if(shippingLocationIdByCountry!==null){shippingLocationId=shippingLocationIdByCountry;}}
if(!isNaN(shippingLocationId)){this.addShippingLocationIdCartAttribute(shippingLocationId);}}
return shippingLocationId;},getShippingCountryId:function(){var shippingCountryId=parseInt($('#shippingCountry').val());if(isNaN(shippingCountryId)){shippingCountryId=parseInt($('[data-type="shipping-address-wrapper"] .address-block-header > div').attr('data-country-id'));}
return shippingCountryId;},getShippingAddressId:function(){var shippingAddressId=null;var shippingAddressIdElement=$('input[name=shippingAddressId]');if(typeof shippingAddressIdElement!=="undefined"&&shippingAddressIdElement!==null){shippingAddressId=parseInt(shippingAddressIdElement.val());}
return shippingAddressId;},getShippingLocationIdByCountry:function(){var shippingLocationId=null;var shippingCountryId=this.getShippingCountryId();if(!isNaN(shippingCountryId)){var loadShippingCompaniesUrl='/order/get-location-by-country/'+shippingCountryId;IdeaApp.helpers.ajaxRequest({url:loadShippingCompaniesUrl,async:false,method:'GET',success:function(response){shippingLocationId=response;}});}
return shippingLocationId;},getShippingLocationIdByAddress:function(){var shippingLocationId=null;var shippingAddressId=this.getShippingAddressId();if(shippingAddressId>0){var loadShippingCompaniesUrl='/order/get-location-by-address/'+shippingAddressId;IdeaApp.helpers.ajaxRequest({url:loadShippingCompaniesUrl,async:false,method:'GET',success:function(response){shippingLocationId=response;}});}
return shippingLocationId;},changeShippingCompany:function(element){element.parents('.cart-block').removeClass('cart-block-error');this.loadCartSummary();},changeCountry:function(countryCode){const appCountry=IdeaApp.helpers.getCookie('APP_COUNTRY');if(appCountry==countryCode){return;}
IdeaApp.helpers.setCookie('APP_COUNTRY',countryCode,60);var cartSessionId=IdeaCart.sessionId;if(cartSessionId===''||typeof cartSessionId==="undefined"){return;}
var params={"app_country":countryCode,"cart_session_id":cartSessionId};IdeaApp.helpers.ajaxRequest({url:'/cart/add_attribute',type:'POST',data:params,success:function(response){}});},setDefaultShippingCountry:function(){var dataCountryCodeElement=document.querySelector('[data-country-code][data-type="shipping"]');if(dataCountryCodeElement!=null){var selectedCountry=dataCountryCodeElement.getAttribute('data-country-code');IdeaApp.order.step2.changeCountry(selectedCountry);}},loadLocationShippingCountryAbroad:function(){var self=this;var shippingCountryElement=document.getElementById('shippingCountry');if(shippingCountryElement!=null){var countryId=parseInt($(shippingCountryElement).val());if(countryId!==1&&countryId!==170){self.loadShippingCompanies();}}},loadShippingCompanies:function(){if($('#checkout-cargo-details-content').length==0){return;}
var shippingLocationId=this.getShippingLocationId();if(isNaN(shippingLocationId)){var loadShippingCompaniesUrl='/order/view-shipping-companies/';}else{var loadShippingCompaniesUrl='/order/view-shipping-companies/'+shippingLocationId;}
IdeaApp.helpers.ajaxRequest({url:loadShippingCompaniesUrl,async:false,success:function(response){$('#checkout-cargo-details-content').html(response);$('[data-toggle="tooltip"]').tooltip();}});},loadCartSummary:function(){var shippingLocationId=this.getShippingLocationId();var params={'shippingLocationId':shippingLocationId,'shippingCompanyId':$('input[name="shippingCompanyId"]:checked').val(),'anticsrf':anticsrf};IdeaApp.plugins.loadingBar.show();IdeaApp.helpers.ajaxRequest({url:'/order/view-cart-summary',data:params,success:function(response){if(typeof response.errorMessage=='undefined'){$('.cart-panel-amount-details').html(response);}else{IdeaApp.plugins.notification(response.errorMessage,'warning');}
IdeaApp.plugins.loadingBar.hide();}});},addShippingLocationIdCartAttribute:function(shippingLocationId){var cartSessionId=IdeaCart.sessionId;var shippingLocationDataFromCookie=IdeaApp.helpers.getCookie('shipping_location_data');if(cartSessionId===''||typeof cartSessionId==="undefined"){return;}
if(shippingLocationDataFromCookie!==''){var cartSessionIdFromCookie=shippingLocationDataFromCookie.split("_")[0];var shippingLocationIdFromCookie=shippingLocationDataFromCookie.split("_")[1];if((cartSessionIdFromCookie===cartSessionId)&&(shippingLocationId==shippingLocationIdFromCookie)){}}
var params={"shipping_location_id":shippingLocationId,"cart_session_id":cartSessionId};IdeaApp.helpers.ajaxRequest({url:'/cart/add_attribute',type:'POST',data:params,success:function(response){var shippingLocationData=cartSessionId+'_'+shippingLocationId;IdeaApp.helpers.setCookie('shipping_location_data',shippingLocationData);}});},submitStep2Form:function(submitButton){var formElement=$('#step2Form');if(!formElement.valid()){return;}
submitButton.addClass('btn-loading').attr('disabled','disabled');if(isMember&&!this.memberAddress.checkRequiredFields()){submitButton.removeClass('btn-loading').removeAttr('disabled');return;}
formElement.submit();},memberAddress:{init:function(){if(!isMember){return;}
this.control();this.overlay.check();this.eventListener();},toggle:function(element){if(element.hasClass('active')){element.removeClass('active');}else{$('.address-block').removeClass('active');element.addClass('active');}},select:function(element){var addressId=element.attr('data-id');var addressType=element.attr('data-type');var addressHiddenSelector=$('[name="'+addressType+'AddressId"]');var countryCodeHiddenSelector=$('[name="'+addressType+'CountryCode"]');if(addressId==addressHiddenSelector.val()){return;}
addressHiddenSelector.val(addressId);var countryCode=element.attr('data-country-code');IdeaApp.order.step2.changeCountry(countryCode);$('[data-type="'+addressType+'-address-wrapper"]').find('.address-block-header').html(element.clone());if(addressType=='shipping'){this.copyShippingAddress();IdeaApp.order.step2.loadShippingCompanies();IdeaApp.order.step2.loadCartSummary();}},control:function(){$('.address-block').each(function(){if($(this).find('.address-block-content-scroll > div').length==1){$(this).find('[data-selector="delete-address"]').hide();}else{$(this).find('[data-selector="delete-address"]').show();}});},add:function(submitButton){var self=this;self.removeRequiredFields();var addressType=submitButton.attr('data-type');var formElement=submitButton.parents('form');if(!formElement.valid()){return;}
submitButton.addClass('btn-loading').attr('disabled','disabled');IdeaApp.helpers.ajaxRequest({url:'/order-address/add-contact-information/'+addressType,data:formElement.serialize(),success:function(response){if(typeof response.errorMessage!=='undefined'){IdeaApp.plugins.notification(response.errorMessage,'warning');}else{if(addressType=='all'){$('#step2Form .address-wrapper').html(response);}else{var addressWrapper=$('[data-type="'+addressType+'-address-wrapper"]');addressWrapper.find('.address-block-header').html(response);addressWrapper.find('.address-block-content-scroll').append(response);var currentAddressId=parseInt(addressWrapper.find('.address-block-header > div').attr('data-id'));$('input[name="'+addressType+'AddressId"]').val(currentAddressId);var currentShippingCountryCode=addressWrapper.find('.address-block-header > div').attr('data-country-code');IdeaApp.order.step2.changeCountry(currentShippingCountryCode);}
if(addressType!=='billing'){IdeaApp.order.step2.loadShippingCompanies();IdeaApp.order.step2.loadCartSummary();}
self.control();self.hideAddressForm();}
submitButton.removeClass('btn-loading').removeAttr('disabled');}});},edit:function(submitButton){var self=this;self.removeRequiredFields();var addressId=submitButton.attr('data-id');var addressType=submitButton.attr('data-type');var formElement=submitButton.parents('form');if(!formElement.valid()){return;}
submitButton.addClass('btn-loading').attr('disabled','disabled');IdeaApp.helpers.ajaxRequest({url:"/order-address/update-contact-information/"+addressType+"/"+addressId,data:formElement.serialize(),success:function(response){if(typeof response.errorMessage!=='undefined'){IdeaApp.plugins.notification(response.errorMessage,'warning');}else{var addressWrapper=$('[data-type="'+addressType+'-address-wrapper"]');if(addressId==$('input[name="'+addressType+'AddressId"]').val()){addressWrapper.find('.address-block-header').html(response);}
var shippingCountryElement=document.getElementById('shippingCountry');if(shippingCountryElement!=null){var currentShippingCountryCode=shippingCountryElement.options[shippingCountryElement.selectedIndex].dataset.countryCode;}else{var currentShippingCountryCode=addressWrapper.find('.address-block-header > div').attr('data-country-code');}
var addressBlockContentElement=document.querySelector('.address-block-content [data-id="'+addressId+'"][data-type="shipping"]');if(addressBlockContentElement!==null){addressBlockContentElement.setAttribute('data-country-code',currentShippingCountryCode)}
IdeaApp.order.step2.changeCountry(currentShippingCountryCode);var contentWrapper=addressWrapper.find('.address-block-content-scroll').find('[data-id="'+addressId+'"]');contentWrapper.attr('data-location-id',$(response).attr('data-location-id'));contentWrapper.html($(response).html());if(addressType=='shipping'&&addressId==$('input[name="shippingAddressId"]').val()){IdeaApp.order.step2.loadShippingCompanies();IdeaApp.order.step2.loadCartSummary();}
self.control();self.hideAddressForm();}
submitButton.removeClass('btn-loading').removeAttr('disabled');}})},delete:function(element){var self=this;var addressId=element.attr('data-id');var addressType=element.attr('data-type');element.addClass('btn-loading').attr('disabled','disabled');IdeaApp.plugins.loadingBar.show();IdeaApp.helpers.ajaxRequest({url:"/order-address/delete-contact-information/"+addressType+"/"+addressId,data:{'anticsrf':anticsrf},success:function(response){if(response.success){$('.address-block [data-id="'+addressId+'"]').remove();var addressWrapper=$('[data-type="'+addressType+'-address-wrapper"]');if(addressWrapper.find('.address-block-header > div').length==0){var addressContent=addressWrapper.find('.address-block-content-scroll > div:first-child').clone();var countryCodeHiddenSelector=$('[name="'+addressType+'CountryCode"]');addressWrapper.find('.address-block-header').html('').append(addressContent);var currentAddressId=parseInt(addressWrapper.find('.address-block-header > div').attr('data-id'));var currentShippingCountryCode=addressWrapper.find('.address-block-header > div').attr('data-country-code');IdeaApp.order.step2.changeCountry(currentShippingCountryCode);$('input[name="'+addressType+'AddressId"]').val(currentAddressId);self.control();if(addressType=='shipping'){IdeaApp.order.step2.loadShippingCompanies();IdeaApp.order.step2.loadCartSummary();}}}else{IdeaApp.plugins.notification(response.errorMessage,'warning');}
element.removeClass('btn-loading').removeAttr('disabled');IdeaApp.plugins.loadingBar.hide();}});},removeRequiredFields:function(){$('input[name="deliveryDate"]').rules("remove","required");$('select[name="deliveryTime"]').rules("remove","required");$('input[name="shippingCompanyId"]').rules("remove","required");},addRequiredFields:function(){$('input[name="deliveryDate"]').rules('add',{required:true});$('select[name="deliveryTime"]').rules('add',{required:true});$('input[name="shippingCompanyId"]').rules('add',{required:true});},showAddAddressForm:function(element){var self=this;element.addClass('btn-loading').attr('disabled','disabled');IdeaApp.helpers.ajaxRequest({url:"/order-address/view-add-contact-information/"+element.attr('data-type'),async:false,success:function(response){$('#step2Form').before(response);$('#step2Form .address-wrapper').hide();IdeaApp.order.step2.addressValidate();element.removeClass('btn-loading').removeAttr('disabled');self.overlay.show();}});},showEditAddressForm:function(element){var self=this;element.addClass('btn-loading').attr('disabled','disabled');IdeaApp.helpers.ajaxRequest({url:"/order-address/view-edit-contact-information/"+element.attr('data-type')+'/'+element.attr('data-id'),async:false,success:function(response){$('#step2Form').before(response);$('#step2Form .address-wrapper').hide();IdeaApp.order.step2.addressValidate();IdeaApp.order.step2.phoneMask();element.removeClass('btn-loading').removeAttr('disabled');self.overlay.show();}});},hideAddressForm:function(){if($('[data-selector="empty-address"]').length>0){return;}
this.addRequiredFields();$('#step2Form .address-wrapper').show();$('#addAddressForm, #editAddressForm, .checkout-overlay').remove();$('html, body').stop(true).animate({scrollTop:0},300);},copyShippingAddress:function(){if(!$('#differentBillingAddress').is(':checked')){return;}
$('input[name="billingAddressId"]').val('');$('[data-type="billing-address-wrapper"]').addClass('disabled').find('.address-block-header').html($('[data-type="shipping-address-wrapper"]').find('.address-block-header').html());$('[data-type="billing-address-wrapper"]').find('.titleTypeName').html($('#billingType').val());},showBillingAddress:function(){var billingAddressWrapper=$('[data-type="billing-address-wrapper"]');var addressContent=billingAddressWrapper.find('.address-block-content-scroll > div:first-child').clone();billingAddressWrapper.removeClass('disabled').find('.address-block-header').html('').append(addressContent);var addressId=parseInt(billingAddressWrapper.find('.address-block-header > div').attr('data-id'));$('input[name="billingAddressId"]').val(addressId);},checkRequiredFields:function(){var addressId;var errorFields=[];var errorMessages=[];if(!$('#differentBillingAddress').is(':checked')){addressId=$('input[name="billingAddressId"]').val();var billingMobilePhoneNumber=$('div[data-type="billing-address-wrapper"] .address-block-header div[data-id="'+addressId+'"] span[data-type="mobile-phone-number"]').text();if(billingMobilePhoneNumber.length==0){errorMessages.push('Lütfen fatura adresinize cep telefonu numarası giriniz.');errorFields.push('mobilePhoneNumber');}
if($('[data-type="identity-registration-number-is-required"]').attr('data-required')==1){var billingInvoiceType=$('div[data-type="billing-address-wrapper"] .address-block-header div[data-id="'+addressId+'"] [data-type="invoice-type"]').text();if(billingInvoiceType=='individual'){var billingIdentityRegistrationNumber=$('div[data-type="billing-address-wrapper"] .address-block-header div[data-id="'+addressId+'"] span[data-type="identity-registration-number"]').text();if(billingIdentityRegistrationNumber.length==0){errorMessages.push('Lütfen fatura adresinize T.C. kimlik numarası giriniz.');errorFields.push('identityRegistrationNumber');}}else if(billingInvoiceType=='corporate'){var taxNumber=$('div[data-type="billing-address-wrapper"] .address-block-header div[data-id="'+addressId+'"] [data-type="tax-number"]').text();var taxOffice=$('div[data-type="billing-address-wrapper"] .address-block-header div[data-id="'+addressId+'"] [data-type="tax-office"]').text();if(taxNumber.length==0){errorMessages.push('Lütfen fatura adresinize vergi numarası giriniz.');errorFields.push('taxNumber');}
if(taxOffice.length==0){errorMessages.push('Lütfen fatura adresinize vergi dairesi giriniz.');errorFields.push('taxOffice');}}}
if(errorMessages.length==0){addressId=$('input[name="shippingAddressId"]').val();var shippingMobilePhoneNumber=$('div[data-type="shipping-address-wrapper"] .address-block-header div[data-id="'+addressId+'"] span[data-type="mobile-phone-number"]').text();if(shippingMobilePhoneNumber.length==0){errorMessages.push('Lütfen teslimat adresinize cep telefonu numarası giriniz.');errorFields.push('mobilePhoneNumber');}}}else{addressId=$('input[name="shippingAddressId"]').val();var shippingMobilePhoneNumber=$('div[data-type="shipping-address-wrapper"] .address-block-header div[data-id="'+addressId+'"] span[data-type="mobile-phone-number"]').text();if(shippingMobilePhoneNumber.length==0){errorMessages.push('Lütfen teslimat adresinize cep telefonu numarası giriniz.');errorFields.push('mobilePhoneNumber');}
if($('[data-type="identity-registration-number-is-required"]').attr('data-required')==1){var shippingIdentityRegistrationNumber=$('div[data-type="shipping-address-wrapper"] .address-block-header div[data-id="'+addressId+'"] span[data-type="identity-registration-number"]').text();if(shippingIdentityRegistrationNumber.length==0){errorMessages.push('Lütfen teslimat adresinize T.C. kimlik numarası giriniz.');errorFields.push('identityRegistrationNumber');}}}
if(errorMessages.length>0){$('[data-selector="edit-address-form"][data-id="'+addressId+'"]').eq(0).click();$(errorFields).each(function(key,value){$('[name="'+value+'"]').addClass('validate-error');});IdeaApp.plugins.notification(errorMessages.join('<br>'),'warning');return false;}
return true;},overlay:{check:function(){if($('[data-selector="empty-address"]').length==0){return;}
this.show();},show:function(){$('html, body').stop(true).animate({scrollTop:$('main').offset().top-15},300);$('body').append('<div class="checkout-overlay"></div>');},hide:function(){$('.checkout-overlay').remove();}},eventListener:function(){var self=this;$(document).on('click','.address-block-content-scroll > div',function(event){if($(event.target).parent().hasClass('address-buttons')){return;}
self.select($(this));});$(document).on('click','.address-block',function(event){if($(event.target).parent().hasClass('address-buttons')){return;}
self.toggle($(this));});$(document).on('click','[data-selector="add-address-form"]',function(){self.showAddAddressForm($(this));});$(document).on('click','[data-selector="edit-address-form"]',function(){self.showEditAddressForm($(this));});$(document).on('click','[data-selector="delete-address"]',function(){self.delete($(this));});$(document).on('click','[data-selector="submit-address-form"]',function(){self.add($(this));});$(document).on('click','[data-selector="submit-edit-address-form"]',function(){self.edit($(this));});$(document).on('click','[data-selector="cancel-address-form"]',function(){self.hideAddressForm();});$(document).on('change','#differentBillingAddress',function(){if($(this).is(':checked')){self.copyShippingAddress();}else{self.showBillingAddress();}});$(document).click(function(event){var addressBlockElement=$('.address-block');if(addressBlockElement.has(event.target).length===0){addressBlockElement.removeClass('active');}});$(document).on('click','.checkout-overlay',function(){self.hideAddressForm();});}},eventListener:function(){var self=this;$(document).on('focus','#deliveryDate',function(){IdeaApp.helpers.datePicker($(this),{language:"tr",format:"dd-mm-yyyy",startDate:new Date()});});$(document).on('change','[data-selector="toggle-gift-note"]',function(){self.toggleGiftNote($(this));});$(document).on('change','#differentBillingAddress',function(){self.toggleBillingAddress($(this));});$(document).on('click','[data-selector="submit-button"]',function(){self.submitStep2Form($(this));});$(document).on('change','[name="country"],[name="billingCountry"]',function(){self.loadLocations($(this));});$(document).on('change','[name="location"],[name="billingLocation"]',function(){self.loadSubLocations($(this));});$(document).on('change','[name="invoiceType"]',function(){self.changeInvoiceType($(this).val());});$(document).on('change','[name="shippingCompanyId"]',function(){self.changeShippingCompany($(this));});$(document).on('click','[data-selector="auto-fill-form"]',function(){self.autoFillForm.init($(this));});}},step3:{init:function(){this.moneyOrder.init();this.creditCard.init();this.mailOrder.init();this.customPayment.init();this.agreement.init();this.paymentTab.init();this.stripe.init();this.eventListener();},getCurrentProviderCode:function(){return $('[data-selector="payment-tab"].active').attr('data-target');},getCurrentFormElement:function(){return $('.payment-tab-content #'+this.getCurrentProviderCode()).find('[data-selector="payment-form"]');},loadCartSummary:function(fromForm){if(!fromForm){fromForm=false;}
var paymentProviderCode=this.getCurrentProviderCode();var params={'providerCode':paymentProviderCode,'anticsrf':anticsrf};var referenceAccountId;var installment;if(paymentProviderCode=='MailOrder'){referenceAccountId=parseInt($('#mailOrderId option:selected').val());installment=parseInt($('input[name="m_inst"]:checked').val());}else if(paymentProviderCode=='CreditCard'){referenceAccountId=parseInt($('input[name="posid"]').val());installment=parseInt($('input[name="inst"]:checked').val());}else if($.inArray(paymentProviderCode,['CodCash','CodCC'])){referenceAccountId=parseInt(this.getCurrentFormElement().attr('data-shipping-company-id'));}
if(paymentProviderCode=='Iyzico'){installment=IdeaApp.order.step3.iyzico.installment;params["totalAmount"]=IdeaApp.order.step3.iyzico.totalAmount;}
if(paymentProviderCode=='Ozan'){installment=IdeaApp.order.step3.ozan.installment;if(IdeaApp.order.step3.ozan.totalAmount>0){params["totalAmount"]=IdeaApp.order.step3.ozan.totalAmount;}}
if(!isNaN(referenceAccountId)){params['referenceAccountId']=referenceAccountId;}
if(!isNaN(installment)){params["installment"]=installment;}
if($('.loading-bar').length==0){IdeaApp.plugins.loadingBar.show();}
IdeaApp.helpers.ajaxRequest({data:params,url:"/order/view-cart-summary",success:function(response){if(typeof response.errorMessage=='undefined'){$('.cart-panel-amount-details').html(response);if(fromForm){if(paymentProviderCode=='Iyzico'||paymentProviderCode=='Ozan'){$('#cart-total-amount').html($('[data-selector="total-amount"]').html())}else{$('[data-selector="total-amount"]').html($('#cart-total-amount').html());}}else{$('[data-selector="total-amount"]').html($('#cart-total-amount').html());}}else{IdeaApp.plugins.notification(response.errorMessage,'warning');}
IdeaApp.order.step3.agreement.load(params);}});},showEditAddressDialog:function(element){IdeaApp.plugins.confirmDialog(element.attr('data-message-text'),function(){window.location='/order/step2';});},changeCardCvc:function(element){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();currentFormElement.find('.card-cvc').text(element.val().replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"));},changeCardMonth:function(element){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();currentFormElement.find('.card-month').text(element.val().replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"));},changeCardYear:function(element){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();currentFormElement.find('.card-year').text(element.val().replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"));},changeCardName:function(element){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();currentFormElement.find('.card-name').text(element.val().replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"));},changeCardTypeLogo:function(binSettings){var prefix=this.getCurrentProviderCode()=='MailOrder'?'m_':'';var currentFormElement=this.getCurrentFormElement();currentFormElement.find("#visa-card-logo, #master-card-logo,  #amex-logo, #troy-logo").addClass('d-none');if(binSettings.cardAssociation=='VISA'){currentFormElement.find("#visa-card-logo").removeClass('d-none');$('input[name="'+prefix+'cctype"]').val(1);}else if(binSettings.cardAssociation=='MASTER_CARD'){currentFormElement.find("#master-card-logo").removeClass('d-none');$('input[name="'+prefix+'cctype"]').val(2);}else if(binSettings.cardAssociation=='AMERICAN_EXPRESS'&&binSettings.bankCode=='62'){currentFormElement.find("#amex-logo").removeClass('d-none');$('input[name="'+prefix+'cctype"]').val(3);}else if(binSettings.cardAssociation=='TROY'){currentFormElement.find("#troy-logo").removeClass('d-none');$('input[name="'+prefix+'cctype"]').val(1);}else{currentFormElement.find("#visa-card-logo").removeClass('d-none');$('input[name="'+prefix+'cctype"]').val(1);}
currentFormElement.find('.payment-credit-card').addClass('d-flex');},paymentFormSubmit:function(){var currentFormElement=this.getCurrentFormElement();var agreementValid=this.agreement.validAgreements();if(currentFormElement.valid()&&agreementValid){var submitButton=$('[data-selector="submit-button"]');var providerCode=this.getCurrentProviderCode();submitButton.addClass('btn-loading').attr('disabled','disabled');switch(providerCode){case 'Iyzico':case 'PayWithIyzico':this.iyzico.submitForm(submitButton);break;case 'Ozan':this.ozan.submitForm(submitButton);break;case 'BKMExpress':this.bkmExpress.submitForm(submitButton);break;case 'MailOrder':this.mailOrder.submitForm(submitButton);break;case 'CreditCard':this.creditCard.submitForm(submitButton);break;case 'Stripe':this.stripe.submitForm(submitButton);break;default:currentFormElement.submit();break;}}},creditCard:{binCache:null,bonusLoad:false,binSettings:null,posAccountId:null,paymentGateway:null,mainPaymentGateway:null,init:function(){if($('#CreditCard').length==0){return;}
this.masterpass.check();this.formValidate();this.eventListener();},formValidate:function(){$('#CreditCard [data-selector="payment-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',focusInvalid:false,rules:{ccname:{required:true,creditCardName:true},creditCardNumber:{required:true,creditCardNumber:true},cvc2:{required:true,minlength:3},ccmonth:{required:true},ccyear:{required:true},cctype:{required:true},"masterpass-card-name":{masterpassCardName:true}},messages:{ccname:{required:"Lütfen kart üzerindeki isim alanını giriniz.",creditCardName:"Lütfen kart üzerindeki isim alanını kontrol ediniz.",},creditCardNumber:{required:"Lütfen kredi kartı numarası giriniz.",creditCardNumber:"Lütfen geçerli kart numarası giriniz."},cvc2:{required:"CVC giriniz.",minlength:"CVC giriniz."},ccmonth:{required:"Ay seçiniz."},ccyear:{required:"Yıl seçiniz."},cctype:{required:"Kart tipini seçiniz."},"masterpass-card-name":{masterpassCardName:"Lütfen geçerli kart ismi giriniz."}},invalidHandler:function(form,validator){if(!validator.numberOfInvalids()){return;}
$('html, body').animate({scrollTop:$(validator.errorList[0].element).parents('.cart-block').offset().top-10},200);},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('creditCardName',function(value){return IdeaApp.helpers.checkCreditCardName(value);});$.validator.addMethod('creditCardNumber',function(value){return IdeaApp.helpers.checkCreditCardNumber(value);});$.validator.addMethod('masterpassCardName',function(value){if($('input[name="masterpass-save"]').is(':checked')&&value.length<3){return false;}
return true;});$('#creditCardNumber').payment('formatCardNumber');$('#creditCardCvc').payment('formatCardCVC');},changeCardNumber:function(element){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var cartNumber=element.val().replace(/\s+/g,"");var binNumber=cartNumber.toString().substring(0,6);currentFormElement.find('.card-number').html(element.val());if(binNumber.length<6){if(this.binCache!=null){IdeaApp.plugins.loadingBar.show('body','no-overlay');IdeaApp.order.step3.loadCartSummary();}
this.binCache=null;this.hideFormElements();$('[data-selector="installment-empty"] li').html('Kartınıza özel taksit opsiyonlarını görebilmek için, lütfen kart numarasını giriniz.');}else if(binNumber.length==6&&binNumber!=this.binCache){this.loadSettings(binNumber);this.binCache=binNumber;}},resetCardNumber:function(element){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();element.addClass('d-none');currentFormElement.find('.card-number').html('');currentFormElement.find("[id^='creditCard']").removeAttr('disabled');currentFormElement.find('#creditCardNumber').val('');currentFormElement.find('#creditCardNumber').parents('.custom-placeholder').removeClass('active').removeClass('focused');$('[data-selector="installment-empty"] li').html('Kartınıza özel taksit opsiyonlarını görebilmek için, lütfen kart numarasını giriniz.');this.hideFormElements();IdeaApp.order.step3.loadCartSummary();},loadSettings:function(binNumber){var self=this;IdeaApp.plugins.loadingBar.show('body','no-overlay');IdeaApp.helpers.ajaxRequest({url:"/order/credit-card-settings",data:{'bin_number':binNumber,'anticsrf':anticsrf},success:function(response){if(response.success){self.binSettings=response.data.bin_settings;self.paymentGateway=response.data.payment_gateway;self.mainPaymentGateway=response.data.main_payment_gateway;self.posAccountId=self.getCurrentGateway().pos_account_id;self.masterpass.checkProviderType();self.changeBankLogo();IdeaApp.order.step3.changeCardTypeLogo(self.binSettings);self.changeFormSettings();self.checkSubscription();self.checkBonusDetails();self.changeInstallmentOptions();IdeaApp.order.step3.loadCartSummary();}else{$('[data-selector="installment-empty"] li').html('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.');self.hideFormElements();}},error:function(){$('[data-selector="installment-empty"] li').html('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.');self.hideFormElements();}});},changeBankLogo:function(){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();currentFormElement.find('.card-logo img').attr('src',this.paymentGateway.logo_path).removeClass('d-none');currentFormElement.find('.card-logo i').addClass('d-none');},changeInstallmentOptions:function(){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var checked='checked';var installmentOptions=this.paymentGateway.installment_options;if(this.mainPaymentGateway&&this.mainPaymentGateway.installment_options.length>0){if(typeof installmentOptions[0]!=='undefined'&&installmentOptions[0].count>1){for(var i=36;i>=0;i--){if(typeof installmentOptions[i]!=='undefined'){installmentOptions[i+1]=installmentOptions[i];delete installmentOptions[i];}}}
checked='';installmentOptions[0]=this.mainPaymentGateway.installment_options[0];}
if(installmentOptions.length<1||(this.binSettings.cardType=='DEBIT_CARD'&&installmentOptions[0].count!=1)){currentFormElement.find('[data-selector="credit-card-installments"] [data-selector="installment-empty"]').removeClass('d-none');currentFormElement.find('[data-selector="credit-card-installments"] [data-selector="instalment-hall"]').html('').addClass('d-none');$('[data-selector="installment-empty"] li').html('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.');return;}
var output='';if(installmentOptions.length>0){output+=' \
                        <li> \
                            <div class="form-group row"> \
                                <div class="col-6"></div> \
                                <div class="col-3 text-right pl-0">Aylık</div> \
                                <div class="col-3 text-right pl-0">Toplam</div> \
                            </div> \
                        </li>';}
for(var i=0;i<installmentOptions.length;i++){var installmentOption=installmentOptions[i];var monthlyPrice,installmentInfo;var installmentLang=currentFormElement.find('[data-selector="installment-hall"]').attr('data-installment-lang');if(installmentOption.count==1){monthlyPrice='-';if(installmentOption.extra_installment>0){monthlyPrice=installmentOption.monthly_price+' '+installmentOption.currency;installmentInfo=installmentOption.count+'+<b>'+installmentOption.extra_installment+'</b>'+' '+installmentLang;}else{installmentInfo=currentFormElement.find('[data-selector="installment-hall"]').attr('data-first-installment-lang');}}else{monthlyPrice=installmentOption.monthly_price+' '+installmentOption.currency;if(installmentOption.extra_installment>0){installmentInfo=installmentOption.count+'+<b>'+installmentOption.extra_installment+'</b>'+' '+installmentLang;}else{installmentInfo=installmentOption.count+' '+installmentLang;}}
var paidPrice=installmentOption.paid_price+' '+installmentOption.currency;output+='\
                            <li> \
                                <div class="row"> \
                                    <div class="col-6"> \
                                        <div class="radio-custom"> \
                                            <input type="radio" id="cardInstallment'+installmentOption.count+'" name="inst" value="'+installmentOption.count+'" '+checked+'/> \
                                            <label for="cardInstallment'+installmentOption.count+'"> \
                                                '+installmentInfo+'\
                                            </label> \
                                        </div> \
                                    </div> \
                                    <div class="col-3 text-right pl-0"> \
                                        <strong>'+monthlyPrice+'</strong> \
                                    </div> \
                                    <div class="col-3 text-right pl-0"> \
                                        <strong>'+paidPrice+'</strong> \
                                    </div> \
                                </div> \
                            </li>';checked='';if(this.binSettings.cardType=='DEBIT_CARD'){break;}}
currentFormElement.find('[data-selector="installment-empty"]').addClass('d-none');currentFormElement.find('[data-selector="installment-hall"]').slideDown(100).removeClass('d-none');currentFormElement.find('[data-selector="installment-hall"]').html(output);},changeFormSettings:function(){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var formSettings=this.paymentGateway.form_settings;var threeDStatus='passive';if(typeof formSettings.three_d_status!='undefined'){threeDStatus=formSettings.three_d_status;}
if(!formSettings.has_form){$("[id^='creditCard']").attr("disabled",true);$('[data-selector="common-payment-info"], [data-selector="reset-card-number"]').removeClass('d-none');if(this.masterpass.status&&!this.masterpass.hasRegisteredCard){$('#masterpass-save-card-form').addClass('d-none');$('input[name="creditCardNumber"]').removeClass('validate-error').next('.validate-error').remove();}}else{$("[id^='creditCard']").attr("disabled",false);$('[data-selector="common-payment-info"]').addClass('d-none');if(threeDStatus=='optional'){$('[data-selector="optional-three-d"]').removeClass('d-none');}else{$('[data-selector="optional-three-d"]').addClass('d-none');}}
currentFormElement.attr('action',this.getCurrentGateway().form_url);currentFormElement.find('input[name="posid"]').val(this.getCurrentGateway().pos_account_id);currentFormElement.find('input[name="three_d_status"]').val(threeDStatus);},hideFormElements:function(){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();currentFormElement.find('[data-selector="installment-empty"]').removeClass('d-none');currentFormElement.find('[data-selector="installment-hall"]').html('').addClass('d-none');currentFormElement.find('.card-logo img').attr('src','/images/blank.gif');currentFormElement.find('.card-logo img, .card-type-logo img, .card-campaign').addClass('d-none');currentFormElement.find('.card-logo i').removeClass('d-none');currentFormElement.find('[data-selector="use-bonus"]').addClass('d-none');currentFormElement.find('[data-selector="optional-three-d"]').addClass('d-none').attr('checked',false);currentFormElement.find('input[name="posid"]').val('');currentFormElement.find('input[name="cctype"]').val('1');currentFormElement.find('[data-selector="common-payment-info"]').addClass('d-none');currentFormElement.find('.payment-credit-card').removeClass('d-flex');currentFormElement.parents('.payment-tab-content').find('.subscription-alert').addClass('d-none');if(this.masterpass.status&&!this.masterpass.hasRegisteredCard){$('#masterpass-save-card-form').removeClass('d-none');}
IdeaApp.plugins.loadingBar.hide();this.resetVadaaDetails();this.resetBonusDetails();},checkBonusDetails:function(){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var ccType=currentFormElement.find('[name="cctype"]').val();var installment=$('input[name="inst"]:checked').val();if(this.paymentGateway.form_settings.use_bonus&&ccType!=3&&installment>0&&this.posAccountId==1&&this.binSettings.cardType!='DEBIT_CARD'){currentFormElement.find('[data-selector="use-bonus"], [data-selector="bonus-info"]').removeClass('d-none');}else{currentFormElement.find('[data-selector="use-bonus"], [data-selector="bonus-info"]').addClass('d-none');}},resetBonusDetails:function(){if(this.posAccountId!=1){return false;}
var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();currentFormElement.find('[data-selector="bonus-info"]').addClass('d-none');currentFormElement.find('input[name="bonusPrice"]').attr('disabled','disabled').val(0);currentFormElement.find('input[name="useBonus"]').prop('checked',false);this.bonusLoad=false;},loadBonusDetails:function(element){var self=this;var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();if(!currentFormElement.valid()){element.prop('checked',false);return false;}
if(this.bonusLoad){if(!element.is(':checked')){currentFormElement.find('[data-selector="bonus-info"]').addClass('d-none');currentFormElement.find('input[name="bonusPrice"]').attr('disabled','disabled');}else{currentFormElement.find('[data-selector="bonus-info"]').removeClass('d-none');currentFormElement.find('input[name="bonusPrice"]').removeAttr('disabled');}
return;}
currentFormElement.find('[data-selector="bonus-info"]').removeClass('d-none');IdeaApp.plugins.loadingBar.show();IdeaApp.helpers.ajaxRequest({url:"/order/bonus-details",data:{'card_number':currentFormElement.find('input[name="creditCardNumber"]').val().replace(/\s+/g,""),'cvc':currentFormElement.find('input[name="cvc2"]').val(),'cc_month':currentFormElement.find('[name="ccmonth"]').val(),'cc_year':currentFormElement.find('[name="ccyear"]').val(),'installment':currentFormElement.find('input[name="inst"]:checked').val(),'anticsrf':anticsrf},success:function(response){if(response.success){self.bonusLoad=true;currentFormElement.find('[data-selector="bonus-info"] .cart-alert').html('** Kart Puanlarınız : '+response.data.bonus_price+' TL');currentFormElement.find('input[name="bonusPrice"]').removeAttr('disabled').val(response.data.bonus_price);}else{self.resetBonusDetails();}
IdeaApp.plugins.loadingBar.hide();},error:function(){self.resetBonusDetails();IdeaApp.plugins.loadingBar.hide();}});},resetVadaaDetails:function(){if(this.posAccountId!=10){return false;}
var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();currentFormElement.find(".card-campaign").hide();currentFormElement.find('[data-selector="joker-vadaa-box"]').html('');},checkVadaaDetails:function(){var threeDStatus=$('input[name="three_d_status"]').val();if(this.posAccountId!=10||threeDStatus=='active'||$('#use3d').is(':checked')){$(".card-campaign").addClass('d-none');$('input[name="jokerOption[]"]').attr('disabled','disabled');return;}
if($('input[name="inst"]:checked').val()>1){$(".card-campaign").removeClass('d-none');$('input[name="jokerOption[]"]').removeAttr('disabled');}else{$(".card-campaign").addClass('d-none');$('input[name="jokerOption[]"]').attr('disabled','disabled');}},loadVadaaDetails:function(){var cardNumber=$("#creditCardNumber").val();if(!IdeaApp.helpers.checkCreditCardNumber(cardNumber)){$('[data-selector="joker-vadaa-box"]').html('');IdeaApp.plugins.notification('Lütfen geçerli kredi kartı numarası giriniz.','warning');return;}
IdeaApp.plugins.loadingBar.show();IdeaApp.helpers.ajaxRequest({url:"/order/joker-vadaa-details",data:{'card_number':cardNumber.replace(/\s+/g,""),'anticsrf':anticsrf},success:function(response){if(response.success){if(response.data.campaigns.length==0){IdeaApp.plugins.notification('Herhangi bir Joker Vadaa Kampanyası bulunamadı.','warning');}else{var output='\
                                            <li class="mb-3">\
                                                <div class="radio-custom">\
                                                    <input type="radio" id="campaign0" name="jokerOption[]" value="0" checked/>\
                                                    <label for="campaign0">Kampanyadan yararlanmak istemiyorum.</label>\
                                                </div>\
                                            </li>';for(var i=0;i<response.data.campaigns.length;i++){var campaignDetail=response.data.campaigns[i];output+='\
                                            <li class="mb-3">\
                                                <div class="radio-custom">\
                                                    <input type="radio" id="campaign'+campaignDetail.code+'" name="jokerOption[]" value="'+campaignDetail.code+'"/>\
                                                    <label for="campaign'+campaignDetail.code+'">'+campaignDetail.message+'</label>\
                                                </div>\
                                            </li>';}
$('[data-selector="joker-vadaa-box"]').html(output);}}else{IdeaApp.plugins.notification('Herhangi bir Joker Vadaa Kampanyası bulunamadı.','warning');}
IdeaApp.plugins.loadingBar.hide();},});},checkSubscription:function(){var hasSubscriptionItem=$('.subscription-alert').length>0?true:false;var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();if(hasSubscriptionItem&&(this.getCurrentGateway().form_url!='/order/payu'||currentFormElement.find('#masterpass-save').is(':checked'))){currentFormElement.parents('.payment-tab-content').find('.subscription-alert').removeClass('d-none');}else{currentFormElement.parents('.payment-tab-content').find('.subscription-alert').addClass('d-none');}},getCurrentGateway:function(){var creditCardInstallment=$('input[name="inst"]:checked').val();var currentPaymentGateway=this.paymentGateway;if(creditCardInstallment=='1'&&this.mainPaymentGateway){currentPaymentGateway=this.mainPaymentGateway;}
return currentPaymentGateway;},changeInstallment:function(){this.changeFormSettings();this.checkBonusDetails();this.resetBonusDetails();this.checkVadaaDetails();IdeaApp.order.step3.loadCartSummary();},submitForm:function(submitButton){var installmentSelector=$('input[name="inst"]');var installment=$('input[name="inst"]:checked').val();if(installmentSelector.length==0){IdeaApp.plugins.notification('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.','warning');submitButton.removeAttr('disabled').removeClass('btn-loading');return;}else if(typeof installment=="undefined"){IdeaApp.plugins.notification('Siparişi tamamlamak için lütfen taksit seçiniz.','warning');submitButton.removeAttr('disabled').removeClass('btn-loading');return;}
if(this.masterpass.status&&(this.masterpass.hasRegisteredCard||$('input[name="masterpass-save"]').is(':checked'))){this.masterpass.validationMasterpassForm();return;}
var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var creditCardNumber=currentFormElement.find('#creditCardNumber').val().replace(/\s+/g,"");$('input[name=ccno1]').val(creditCardNumber.substr(0,4));$('input[name=ccno2]').val(creditCardNumber.substr(4,4));$('input[name=ccno3]').val(creditCardNumber.substr(8,4));$('input[name=ccno4]').val(creditCardNumber.substr(12,4));var threeDStatus=currentFormElement.find('input[name="three_d_status"]');var thirdPartyProviders=['Paynet','Wirecard','PayTR','Paytrek','Hepsipay','BoschSanalPos','TurkPara','PayU','Ipara','Segment'];if((!thirdPartyProviders.includes(IdeaApp.order.step3.creditCard.paymentGateway.provider_type))&&threeDStatus.length>0&&(threeDStatus.val()=='passive'||(threeDStatus.val()=='optional'&&!jQuery('#use3d').is(':checked')))){grecaptcha.execute();}else{currentFormElement.submit();}},masterpass:{status:false,masterpassLoad:false,hasRegisteredCard:false,load:function(){if(this.masterpassLoad){return;}
this.checkMasterPassEndUser();this.requestError();this.eventListener();this.masterpassLoad=true;},requestError:function(){var self=this;window.onerror=function(msg){if(msg!='Script error.'){return;}
IdeaApp.plugins.loadingBar.hide();$('#masterpass-save-card-form, #masterpass-cart-list').addClass('d-none');$('[data-selector="credit-card-box"]').removeClass('d-none');self.status=false;};},check:function(){if($('#masterpass-wrapper').length>0){this.status=true;if(IdeaApp.order.step3.getCurrentProviderCode()==='CreditCard'){this.load();}}else{this.status=false;}},checkProviderType:function(){var inValidProviderTypeList=['Ziraat','Paynet','Denizbank','TurkPara','KuveytTurk','Segment','TurkiyeFinans','IsBank','Hepsipay','Odeabank'];if(this.status){if($.inArray(IdeaApp.order.step3.creditCard.paymentGateway.provider_type,inValidProviderTypeList)!==-1){$('#masterpass-save-card-form').addClass('d-none');}}},loadToken:function(tokenParams){var token=null;IdeaApp.helpers.ajaxRequest({url:'/masterpass/create_token',async:false,data:tokenParams,success:function(response){if(response.success){token=response.data.token;}else{$('[data-selector="submit-button"]').removeClass('btn-loading').removeAttr('disabled');IdeaApp.plugins.notification(response.errorMessage,'warning');}}});return token;},selectedCard:function(element){var self=this;self.hasRegisteredCard=true;$('[data-selector="credit-card-box"], #masterpass-save-card-form').addClass('d-none');IdeaApp.plugins.loadingBar.show();var binNumber=element.attr('data-binnumber').split('*')[0];IdeaApp.order.step3.creditCard.loadSettings(binNumber);},selectedOtherCard:function(element){var self=this;self.hasRegisteredCard=false;$('[data-selector="credit-card-box"], #masterpass-save-card-form').removeClass('d-none');$('[data-selector="masterpass-card-select"]').parents('.masterpass-card-list-row').removeClass('active');element.parents('.masterpass-card-list-row').addClass('active');IdeaApp.order.step3.creditCard.hideFormElements();},checkMasterPassEndUser:function(){var self=this;IdeaApp.plugins.loadingBar.show();MFS.checkMasterPass($("#masterpass-check-form"),function(status,response){if(response.responseCode=='0000'||response.responseCode==''){if(response.accountStatus.substr(1,4)=='1110'){MFS.listCards($("#masterpass-check-form").find('input[name="userId"]').val(),masterpassToken,function(status,response){if(response.cards){self.listCard(response.cards);}else{self.hasRegisteredCard=false;$('#masterpass-save-card-form').addClass('d-none');}
IdeaApp.plugins.loadingBar.hide();});}else if(response.accountStatus.substr(1,4)=='1100'){self.showLinkCardToClientTemplate();IdeaApp.plugins.loadingBar.hide();}else if(response.accountStatus.substr(1,4)=='0000'){$('[data-selector="credit-card-box"], #masterpass-save-card-form').removeClass('d-none');$('#masterpass-card-list').remove();self.hasRegisteredCard=false;IdeaApp.plugins.loadingBar.hide();}}else{$('[data-selector="credit-card-box"]').removeClass('d-none');$('#masterpass-save-card-form').addClass('d-none');$('#masterpass-card-list').remove();self.hasRegisteredCard=false;self.status=false;IdeaApp.plugins.loadingBar.hide();}});},validationMasterpassForm:function(){var self=this;var currentPaymentGateway=IdeaApp.order.step3.creditCard.getCurrentGateway();if(!self.hasRegisteredCard){if(currentPaymentGateway.gateway_id==null){IdeaApp.plugins.notification('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.','warning');}else{if(currentPaymentGateway.provider_type=='PayU'){IdeaApp.helpers.ajaxRequest({url:'/masterpass/create_additional_parameters',data:{'final_amount':self.getCurrentFinalAmount(),'anticsrf':anticsrf},success:function(response){MFS.setAdditionalParameters(response.data.additional_data);self.registerAndPurchase();}});}else{self.registerAndPurchase();}}}else{if($('input[name="masterpass-card"]:checked').length<1){$('.masterpass-card-list-row .active input[name="masterpassCvc"]').addClass('validate-error').focus();$('[data-selector="submit-button"]').removeClass('btn-loading').removeAttr('disabled');IdeaApp.plugins.notification('Lütfen kayıtlı kartlarınız dan birini seçiniz.','warning');return;}else if($('[data-selector="masterpass-card-select"]:checked').parents('.masterpass-card-list-row').find('input[name="masterpassCvc"]').val().length<3){$('.masterpass-card-list-row .active input[name="masterpassCvc"]').addClass('validate-error').focus();$('[data-selector="submit-button"]').removeClass('btn-loading').removeAttr('disabled');IdeaApp.plugins.notification('Lütfen güvenlik ( CVC ) kodunu giriniz.','warning');return;}
if(currentPaymentGateway.provider_type=='PayU'){IdeaApp.helpers.ajaxRequest({url:'/masterpass/create_additional_parameters',data:{'final_amount':self.getCurrentFinalAmount(),'anticsrf':anticsrf},success:function(response){MFS.setAdditionalParameters(response.data.additional_data);self.purchase();}});}else{self.purchase();}}},registerAndPurchase:function(){var self=this;var token=self.loadToken({gateway_id:IdeaApp.order.step3.creditCard.getCurrentGateway().gateway_id,use_three_d:$('#use3d').is(':checked'),card_type:IdeaApp.order.step3.creditCard.binSettings.cardType,anticsrf:anticsrf});if(token===null){return;}
var registerAndPurchaseForm=$('#masterpass-register-and-purchase-form');registerAndPurchaseForm.find('input[name="installmentCount"]').val(parseInt($('input[name="inst"]:checked').val()));registerAndPurchaseForm.find('input[name="token"]').val(token);registerAndPurchaseForm.find('input[name="accountAliasName"]').val($('input[name="masterpass-card-name"]').val());registerAndPurchaseForm.find('input[name="rtaPan"]').val($('input[name="creditCardNumber"]').val().replace(/\s/g,''));registerAndPurchaseForm.find('input[name="expiryDate"]').val($('select[name="ccyear"]').val()+$('select[name="ccmonth"]').val());registerAndPurchaseForm.find('input[name="cvc"]').val($('input[name="cvc2"]').val());registerAndPurchaseForm.find('input[name="cardHolderName"]').val($('input[name="ccname"]').val());registerAndPurchaseForm.find('input[name="amount"]').val(self.getCurrentFinalAmount());MFS.purchaseAndRegister(registerAndPurchaseForm,function(status,response){if(response.responseCode=="5001"){self.showPopup($('#masterpass-otp-form'),'timer2');$('#masterpass-otp-form').removeClass('d-none');}else if(response.responseCode=="5008"){self.showPopup($('#masterpass-mpin-form'),'timer');$('#masterpass-mpin-form').removeClass('d-none');}else if(response.responseCode=="5010"){$('input[name="masterpass_threed_url"]').val(response.url3D);$('#CreditCard [data-selector="payment-form"]').attr("action","/order/masterpass").submit();}else{$('[data-selector="submit-button"]').removeAttr('disabled').removeClass('btn-loading');IdeaApp.plugins.notification('Masterpass : '+response.responseDescription,'warning');}});},purchase:function(){var self=this;var token=self.loadToken({gateway_id:IdeaApp.order.step3.creditCard.getCurrentGateway().gateway_id,use_three_d:$('.masterpass-card-list-row.active input[name="useMasterpass3d"]').is(':checked'),is_otp_active:false,card_type:IdeaApp.order.step3.creditCard.binSettings.cardType,anticsrf:anticsrf});if(token===null){return;}
var purchaseForm=$('#masterpass-purchase-form');purchaseForm.find('input[name="amount"]').val(self.getCurrentFinalAmount());purchaseForm.find('input[name="listAccountName"]').val($('[data-selector="masterpass-card-select"]:checked').attr('data-cardname'));purchaseForm.find('input[name="cvc"]').val($('[data-selector="masterpass-card-select"]:checked').parents('.masterpass-card-list-row').find('input[name="masterpassCvc"]').val());purchaseForm.find('input[name="installmentCount"]').val(parseInt($('input[name="inst"]:checked').val()));purchaseForm.find('input[name="token"]').val(token);MFS.purchase(purchaseForm,function(status,response){if(response.responseCode==''){$('input[name="masterpass_last_token"]').val(response.token);$('#CreditCard [data-selector="payment-form"]').attr("action","/order/masterpass").submit();}else if(response.responseCode=='5001'){self.showPopup($('#masterpass-otp-form'),'timer2');$('#masterpass-otp-form').removeClass('d-none');}else if(response.responseCode=='5010'){$('input[name="masterpass_threed_url"]').val(response.url3D);$('#CreditCard [data-selector="payment-form"]').attr("action","/order/masterpass").submit();}else{$('[data-selector="submit-button"]').removeAttr('disabled').removeClass('btn-loading');IdeaApp.plugins.notification('Masterpass : '+response.responseDescription,'warning');}});},listCard:function(response){var self=this;self.hasRegisteredCard=true;$('#masterpass-card-list').remove();$('[data-selector="credit-card-box"], #masterpass-save-card-form').addClass('d-none');$('#CreditCard [data-selector="payment-form"]').before('<div class="form-group" id="masterpass-card-list">'+self.listCardTemplate(response)+'</div>');$('[data-toggle="tooltip"]').tooltip();},deleteCard:function(element){var self=this;$('#masterpass-delete-card-form input[name="accountAliasName"]').val($(element).attr('data-card-name'));$(element).addClass('btn-loading').attr('disabled','disabled');MFS.deleteCard($('#masterpass-delete-card-form'),function(status,response){if(response.responseCode=="0000"||response.responseCode==""){IdeaApp.plugins.notification('Kart Silme Başarılı','confirmation');$.fancybox.close();$('#masterpass-card-list').remove();setTimeout(function(){$('#masterpass-delete').remove();},1000);self.checkMasterPassEndUser();}else{IdeaApp.plugins.notification(response.responseDescription,'warning');}
$('.masterpass-modal .btn-primary').removeClass('btn-loading').removeAttr('disabled');});},showCardDeletePopup:function(element){var self=this;var cardName=element.attr('data-card-name');$('body').append(self.deleteCardTemplate(cardName));$.fancybox.open({src:'#masterpass-delete',closeBtn:false,helpers:{overlay:{closeClick:false}}});},cancelCardDeletePopup:function(){$.fancybox.close();setTimeout(function(){$('#masterpass-delete').remove();},1000);},linkCardToClient:function(){var self=this;var token=self.loadToken({use_three_d:false,is_otp_active:false,is_mpin_active:false,anticsrf:anticsrf});if(token===null){return;}
$('.masterpass-modal .btn-primary').addClass('btn-loading');var linkCardToClientForm=$('#masterpass-linkcard-to-client-form');linkCardToClientForm.find('input[name="token"]').val(token);MFS.linkCardToClient($("#masterpass-linkcard-to-client-form"),function(status,response){$.fancybox.close();if(response.responseCode=="0000"||response.responseCode==""){IdeaApp.plugins.notification("Masterpass'e kayıtlı kredi kartlarınızı artık bu sitede kullanabilirsiniz.",'confirmation');}else{if(response.responseCode=="5001"||response.responseCode=="5008"){self.showPopup($('#masterpass-otp-form'),'timer2');$('#otp-form .btn-primary').attr('data-type','link-card-to-client');$('#masterpass-otp-form').removeClass('d-none');}else{IdeaApp.plugins.notification('Masterpass: '+response.responseDescription,'warning');}}
$('.masterpass-modal .btn-primary').removeClass('btn-loading');});},cancelLinkToCardClient:function(){$.fancybox.close();$('#masterpass-save-card-form').remove();},showPopup:function(element,counterElement){var self=this;$.fancybox.open(element,{closeBtn:false,afterLoad:function(){$('[data-selector="submit-button"]').removeClass('btn-loading');$('.masterpass-modal-content .btn-primary').removeClass('btn-loading').removeAttr('disabled');self.countDown(counterElement,function(){$('.masterpass-modal-content .btn-secondary').removeClass('d-none');$('.masterpass-modal-content .btn-primary').addClass('d-none');$('.masterpass-modal-content input[name="validationCode"]').attr('disabled',true).removeClass('validate-error');$('.masterpass-modal-content input[name="validationCode"] + label.validate-error').remove();});},helpers:{overlay:{closeClick:false}}});},validateMpinForm:function(element,parentSelector){var self=this;if(!self.otpFormInputValidate(parentSelector)){return;}
$('.masterpass-modal-content .btn-primary').addClass('btn-loading').attr('disabled','disabled');MFS.validateTransaction($("#mpin-form"),function(status,response){if(status==200){if(response.responseCode=='5001'){$.fancybox.close();self.showPopup($('#masterpass-otp-form'),'timer2');$('#masterpass-otp-form').removeClass('d-none');}else if(response.responseCode=="5010"){$('input[name="masterpass_threed_url"]').val(response.url3D);$('#CreditCard [data-selector="payment-form"]').attr("action","/order/masterpass").submit();}else{IdeaApp.plugins.notification(response.responseDescription,'warning');$('.masterpass-modal .btn-primary').removeClass('btn-loading').removeAttr('disabled');}}});},validateOtpForm:function(element,parentSelector){var self=this;if(!self.otpFormInputValidate(parentSelector)){return;}
element.addClass('btn-loading').attr('disabled','disabled');var validateType=element.attr('data-type');MFS.validateTransaction($("#otp-form"),function(status,response){if(status==200){if(response.responseCode==''){if(validateType=='link-card-to-client'){$.fancybox.close();$('[data-selector="submit-button"]').removeAttr('disabled');self.checkMasterPassEndUser();IdeaApp.plugins.notification("Masterpass'e kayıtlı kredi kartlarınızı artık bu sitede kullanabilirsiniz.",'confirmation');}else{$('input[name="masterpass_last_token"]').val(response.token);$('#CreditCard [data-selector="payment-form"]').attr("action","/order/masterpass").submit();$('[data-selector="submit-button"]').attr('disabled','disabled');}}else if(response.responseCode=="5010"){$('input[name="masterpass_threed_url"]').val(response.url3D);$('#CreditCard [data-selector="payment-form"]').attr("action","/order/masterpass").submit();}else{IdeaApp.plugins.notification(response.responseDescription,'warning');$('.masterpass-modal .btn-primary').removeClass('btn-loading').removeAttr('disabled');}}});},otpFormInputValidate:function(parentSelector){if($(parentSelector).find('input[name="validationCode"]').val().length<1){$(parentSelector).find('input[name="validationCode"]  + label.validate-error').remove();$(parentSelector).find('input[name="validationCode"]').addClass('validate-error');return false;}else{$('input[name="validationCode"]').removeClass('validate-error');$('input[name="validationCode"] + label.validate-error').remove();return true;}},resendOtpForm:function(element){var self=this;var token=MFS.getLastToken();var lang="tur";element.addClass('btn-loading').attr('disabled','disabled');MFS.resendOtp(token,lang,function(){element.removeClass('btn-loading').removeAttr('disabled');$('.masterpass-modal-content .btn-secondary').addClass('d-none');$('.masterpass-modal-content .btn-primary').removeClass('d-none');$('.masterpass-modal-content input[name="validationCode"]').removeAttr('disabled');self.countDown('timer2',function(){$('.masterpass-modal-content .btn-secondary').removeClass('d-none');$('.masterpass-modal-content .btn-primary').addClass('d-none');$('.masterpass-modal-content input[name="validationCode"]').attr('disabled',true).removeClass('validate-error');$('.masterpass-modal-content input[name="validationCode"] + label').remove();});});return false;},countDown:function(element,callback){if($(".fancybox-inner").find('#timer').length==1){element='timer';}
if($(".fancybox-inner").find('#timer2').length==1){element='timer2';}
document.getElementById(element).innerHTML='03'+":"+'00';startTimer();function startTimer(){var presentTime=document.getElementById(element).innerHTML;var timeArray=presentTime.split(/[:]+/);var m=timeArray[0];var s=checkSecond((timeArray[1]-1));if(s==59){m=m-1}
if(m<0){if(callback&&typeof callback=='function'){callback();}
clearInterval(startTimer);}else{document.getElementById(element).innerHTML=m+":"+s;setTimeout(startTimer,1000);}}
function checkSecond(sec){if(sec<10&&sec>=0){sec="0"+sec}
if(sec<0){sec="59"}
return sec;}},getCurrentFinalAmount:function(){var amount;var totalAmountSelector=$('#cart-total-amount');if(IdeaApp.order.step3.creditCard.getCurrentGateway().provider_type=='PayU'){var installment=parseInt($('input[name="inst"]:checked').val());if(installment<=1){amount=totalAmountSelector.attr('data-final-amount');}else{amount=totalAmountSelector.attr('data-general-amount');}}else{amount=totalAmountSelector.attr('data-final-amount');}
return amount.replace(/\./g,'').replace(/\,/g,'');},listCardTemplate:function(response){var output='';output+=' \
                        <div class="masterpass-card-list-title mb-2">Masterpass\'e Kayıtlı Kartlarım</div> \
                        <div class="masterpass-card-list-content">';for(var i=0;i<response.length;i++){var card=response[i];output+='\
                            <div class="radio-custom-groups col-12 masterpass-card-list-row"> \
                                <div class="radio-custom masterpass-card-list-label"> \
                                    <input type="radio" id="masterpass-card-'+i+'" value="'+card.BankIca+'" data-cardname="'+card.Name+'" data-binnumber="'+card.Value1+'" name="masterpass-card" data-selector="masterpass-card-select"/> \
                                    <label class="control-label" for="masterpass-card-'+i+'" > \
                                        <span class="masterpass-card-image">\
                                            <img src="'+masterpassBankLogoList[card.BankIca]+'">\
                                        </span>\
                                        <span class="masterpass-card-text"> \
                                            <span class="masterpass-card-name">'+card.Name+'</span> \
                                            <span class="masterpass-card-value">'+card.Value1+'</span> \
                                        </span> \
                                        <span class="masterpass-card-cvc"> \
                                            <span>Güvenlik ( CVC ) kodu :</span> \
                                            <input type="text" value="" name="masterpassCvc" class="form-control" maxlength="4" autocomplete="off"/> \
                                            <div class="form-question" data-toggle="tooltip" data-placement="bottom" title="CVC Kodu Nedir? Kartınızın arka yüzündeki numaranın son 3 rakamı."> \
                                                <i class="fas fa-info-circle"></i> \
                                            </div> \
                                        </span> \
                                        <a href="javascript:void(0);" class="masterpass-card-delete" data-card-name="'+card.Name+'" onclick="IdeaApp.order.step3.creditCard.masterpass.showCardDeletePopup($(this));"><i class="fas fa-times-circle"></i></a> \
                                    </label> \
                                </div> \
                            </div> ';}
output+=' \
                            <div class="col-12"> \
                                <div class="masterpass-card-list-row"> \
                                    <div class="radio-custom masterpass-card-list-another"> \
                                        <input type="radio" id="masterpass-card" value="0" name="masterpass-card" data-selector="masterpass-card-select"/> \
                                        <label for="masterpass-card">Başka bir kredi kartı ile ödemek istiyorum.</label> \
                                    </div> \
                                </div> \
                            </div>\
                        </div>';return output;},deleteCardTemplate:function(cardName){var output='';output+=' \
                        <div id="masterpass-delete" class="masterpass-modal pb-2 pt-3"> \
                            <div class="masterpass-modal-header text-center"> \
                                <span class="text-center">Masterpass</span> \
                            </div> \
                            <div class="masterpass-modal-content"> \
                                <div class="form-group row"> \
                                    <div class="col-12 p-3 text-center"> \
                                        Masterpass hesabına bağlı <strong>'+cardName+' </strong> adlı kartınızı silmek istediğinizden emin misiniz? \
                                    </div> \
                                    <div class="col-12 text-center"> \
                                        <div class="btn-group-binary">\
                                            <a href="javascript:void(0);" class="btn btn-secondary btn-sm mr-2" onclick="IdeaApp.order.step3.creditCard.masterpass.cancelCardDeletePopup();" >VAZGEÇ</a> \
                                            <a href="javascript:void(0);" class="btn btn-danger btn-sm btn-icon-right" onclick="IdeaApp.order.step3.creditCard.masterpass.deleteCard($(this));" data-card-name="'+cardName+'">SİL</a> \
                                        </div>\
                                    </div> \
                                </div> \
                            </div> \
                        </div>'
return output;},showLinkCardToClientTemplate:function(){var output=' \
                        <div id="masterpass-link-card-to-client-template" class="masterpass-modal"> \
                            <div class="masterpass-modal-header text-center"> \
                                <span class="text-center pb-2">Masterpass</span> \
                            </div> \
                            <div class="masterpass-modal-content"> \
                                <div class="form-group row"> \
                                    <div class="col-12 p-3 text-center"> \
                                        Masterpass\'e kayıtlı kartlarınız bulunmaktadır. Kayıtlı kartlarınızı kullanmak için "Tamam" butonuna tıklayınız. \
                                    </div> \
                                    <div class="col-12 text-center"> \
                                        <div class="btn-group-binary">\
                                            <a href="javascript:void(0);" class="btn btn-secondary btn-sm" onclick="IdeaApp.order.step3.creditCard.masterpass.cancelLinkToCardClient();" >VAZGEÇ</a> \
                                            <a href="javascript:void(0);" class="btn btn-primary btn-sm" onclick="IdeaApp.order.step3.creditCard.masterpass.linkCardToClient($(this));">TAMAM</a> \
                                        </div> \
                                    </div> \
                                </div> \
                            </div> \
                            <div class="masterpass-modal-footer"> \
                                <div class="masterpass-footer-logo"></div> \
                            </div> \
                        </div>';$('body').append(output);$.fancybox.open({src:'#masterpass-link-card-to-client-template',closeBtn:false,helpers:{overlay:{closeClick:false}}});},eventListener:function(){var self=this;$('input[name="validationCode"]').keyup(function(){if($(this).val().length>1){$('.masterpass-modal-content input[name="validationCode"]').removeClass('validate-error').next('label').remove();}else{$('.masterpass-modal-content input[name="validationCode"] + label.validate-error').remove();$('.masterpass-modal-content input[name="validationCode"]').addClass('validate-error');}});$(document).on('change','[data-selector="masterpass-card-select"]',function(){if($(this).val()=='0'){self.selectedOtherCard($(this));}else{self.selectedCard($(this));}});$(document).on('keyup','.masterpass-card-list-row.active input[name="masterpassCvc"]',function(){if($(this).val().length<3){$('.masterpass-card-list-row.active input[name="masterpassCvc"]').addClass('validate-error');}else{$('input[name="masterpassCvc"]').removeClass('validate-error');}});$(document).on('submit','#masterpass-mpin-form form, #masterpass-otp-form form',function(e){e.preventDefault();if(e&&e.keyCode==13){e.preventDefault();}});$(document).on('click','[data-action="validate-mpin-form"]',function(){self.validateMpinForm($(this),'#masterpass-mpin-form');});$(document).on('click','[data-action="validate-otp-form"]',function(){self.validateOtpForm($(this),'#masterpass-otp-form');});$(document).on('click','[data-action="resend-otp-form"]',function(){self.resendOtpForm($(this));});},},eventListener:function(){var self=this;$(document).on('input keyup mouseup keyup cut copy paste','#creditCardName',function(){IdeaApp.order.step3.changeCardName($(this));});$(document).on('change','#creditCardMonth',function(){self.resetBonusDetails();IdeaApp.order.step3.changeCardMonth($(this));});$(document).on('change','#creditCardYear',function(){self.resetBonusDetails();IdeaApp.order.step3.changeCardYear($(this));});$(document).on('input keyup mouseup keyup cut copy paste','#creditCardCvc',function(){self.resetBonusDetails();IdeaApp.order.step3.changeCardCvc($(this));});$('#creditCardNumber').bind("input keyup mouseup keyup cut copy paste",function(){self.resetBonusDetails();self.changeCardNumber($(this));});$(document).on('change','input[name="useBonus"]',function(){self.loadBonusDetails($(this));});$(document).on('change','input[name="inst"]',function(){self.changeInstallment();});$(document).on('click','[data-selector="joker-vadaa"]',function(){self.loadVadaaDetails();});$(document).on('change','input[name="masterpass-save"]',function(){self.checkSubscription();});$(document).on('click','[data-selector="reset-card-number"]',function(){self.resetCardNumber($(this));});$(document).on('change','#use3d',function(){self.checkVadaaDetails();});}},iyzico:{iyzicoLoad:false,payWithIyzicoLoad:false,iyziInit:null,readyToSubmit:false,installment:1,totalAmount:null,installmentAmount:null,payWithIyzicoSelected:false,load:function(){var providerCode=IdeaApp.order.step3.getCurrentProviderCode();if(providerCode=='Iyzico'&&this.iyzicoLoad){$('#iyz-tablist > div:first-child').click();return;}
if(providerCode=='PayWithIyzico'&&this.payWithIyzicoLoad){return;}
var self=this;var providerCode=IdeaApp.order.step3.getCurrentProviderCode();if(providerCode=='PayWithIyzico'){var formSelector='#PayWithIyzico [data-selector="payment-form"]';$('#PayWithIyzico #iyzipay-checkout-form').attr('style','display: none !important');}else{var formSelector='#Iyzico [data-selector="payment-form"]';}
var iyzicoForm=$(formSelector);IdeaApp.plugins.loading.add(formSelector);IdeaApp.helpers.ajaxRequest({url:iyzicoForm.attr('action'),data:iyzicoForm.serialize(),success:function(response){if(providerCode=='Iyzico'){iyzicoForm.append(response);iyzicoForm.append("<input type='hidden' id='iyzicoReadyToSubmit' value='0'>");var iyzicoInterval=setInterval(function(){self.iyziInit=iyziInit;$('.iyz-checkbox-registerCard').click(function(){if(!self.iyziInit.registerCardEnabled){$('#Iyzico .subscription-alert').removeClass('d-none');}else{$('#Iyzico .subscription-alert').addClass('d-none');}});$('#iyz-payment-button').attr('style','display: none !important');$('#iyz-payment-button').attr('disabled','disabled');clearInterval(iyzicoInterval);var providerCode=IdeaApp.order.step3.getCurrentProviderCode();if(providerCode=='PayWithIyzico'){IdeaApp.order.step3.iyzico.payWithIyzicoSelected=true;$('#iyz-tab-payWithIyzico').click();}
if(providerCode=='Iyzico'){$('#iyz-tablist > div:first-child').click();}
self.createOrder();},1000);$(document).on('click','#iyz-tab-payWithIyzico',function(){IdeaApp.order.step3.iyzico.payWithIyzicoSelected=true;$('.iyz-screens button').attr('style','display: none !important');});$(document).on('click','#iyz-tab-credit-card',function(){IdeaApp.order.step3.iyzico.payWithIyzicoSelected=false;});$(document).on('click','#iyz-tab-bankTransfer',function(){IdeaApp.order.step3.iyzico.payWithIyzicoSelected=false;});$(document).on('click','#iyz-tab-apm',function(){IdeaApp.order.step3.iyzico.payWithIyzicoSelected=false;});self.iyzicoLoad=true;}else{var payWithIyzicoButton=document.createElement("button");payWithIyzicoButton.id="payWithIyzicoPageUrl";payWithIyzicoButton.style="display: none !important";payWithIyzicoButton.addEventListener("click",function(){window.location.href=response;});document.body.appendChild(payWithIyzicoButton);self.payWithIyzicoLoad=true;}
IdeaApp.plugins.loading.remove(formSelector);},error:function(){$("#iyzipay-checkout-form").html('');IdeaApp.plugins.notification('Kredi kartı formu yüklenemedi. Lütfen daha sonra tekrar deneyiniz.','warning');IdeaApp.plugins.loading.remove(formSelector);}});},isReadyToSubmit:function(){return $('#iyzicoReadyToSubmit').val();},createOrder:function(){IdeaApp.helpers.ajaxRequest({url:'/order/iyzico/create',data:{'anticsrf':anticsrf,'paidPrice':self.iyziInit.price},success:function(){$('#iyz-payment-button').removeAttr('disabled');var iyzicoInterval=setInterval(function(){if($('.iyz-input-error').length>0||$('[class*=ErrorMessage]').length>0){var submitButton=$('[data-selector="submit-button"]');submitButton.removeAttr('disabled').removeClass('_button-loading');clearInterval(iyzicoInterval);}},1000);}});},submitForm:function(submitButton){var self=this;var providerCode=IdeaApp.order.step3.getCurrentProviderCode();if(providerCode=='Iyzico'&&this.iyziInit==null){submitButton.removeAttr('disabled').removeClass('btn-loading');return;}
if($('.iyz-input-error').length>0&&providerCode=='Iyzico'){$('.iyz-input-error').first().focus();submitButton.removeAttr('disabled').removeClass('btn-loading');return;}
submitButton.addClass('btn-loading').attr('disabled','disabled');$.ajax({url:'/order/iyzico/check',type:'POST',dataType:'json',async:false,data:{'anticsrf':$("input[name*='anticsrf']").val()},success:function(data,status,jqXhr){$('#iyzicoReadyToSubmit').val(1);if(providerCode=='PayWithIyzico'){$('#payWithIyzicoPageUrl').click();}
if(!IdeaApp.order.step3.iyzico.payWithIyzicoSelected){$('#iyz-payment-button').removeAttr('disabled');$('#iyz-payment-button').click();var iyzicoInterval=setInterval(function(){var submitButton=$('[data-selector="submit-button"]')
if($('.iyz-input-error').length>0||$('[class*=ErrorMessage]').length>0){submitButton.removeAttr('disabled').removeClass('btn-loading');clearInterval(iyzicoInterval);IdeaApp.helpers.ajaxRequest({url:'/order/iyzico/unlock-cart',data:{'anticsrf':anticsrf}});}else{$('#ccname').focus().blur();}},1000);}else{$('.iyz-screens button').click();}},error:function(xhr,status){IdeaApp.plugins.notification(xhr.responseJSON.errorMessage,'warning');$('#iyzicoReadyToSubmit').val(0);submitButton.removeAttr('disabled').removeClass('btn-loading');}})}},ozan:{ozanLoad:false,readyToSubmit:false,installment:1,totalAmount:null,installmentAmount:null,load:function(){var formSelector='#Ozan [data-selector="payment-form"]';var ozanForm=$(formSelector);var self=this;if(this.ozanLoad){return;}
IdeaApp.plugins.loading.add(formSelector);IdeaApp.helpers.ajaxRequest({url:ozanForm.attr('action'),data:ozanForm.serialize(),success:function(response){var iframeWin=$('#iFrameOzan');document.getElementById('iFrameOzan').src=response;self.ozanLoad=true;IdeaApp.plugins.loading.remove(formSelector);self.createOrder();window.addEventListener("message",function messageReader(message){if((message.source!==message.target)){var iframeWin1=document.getElementById('iFrameOzan');iframeWin1.contentWindow.postMessage({event:"HIDE_SUBMIT_BUTTON"},"*");if(message.data.event==="RESIZE_FRAME"){iframeWin.height(message.data.data.height);}
if(message.data.event==='FORM_ERROR'){var submitButton=$('[data-selector="submit-button"]');submitButton.removeAttr('disabled').removeClass('btn-loading');}
if(message.data.event==="UPDATE_AMOUNT"){var price=message.data.data.amount/100;var formattedOutput=new Intl.NumberFormat('tr-TR',{style:'currency',currency:'TRY',minimumFractionDigits:2,});$('[data-selector="total-amount"]').html(formattedOutput.format(price));$('#totalAmount').html(formattedOutput.format(price));IdeaApp.order.step3.ozan.installment=message.data.data.installmentCount;IdeaApp.order.step3.ozan.installmentAmount=message.data.data.amount/100;IdeaApp.order.step3.ozan.totalAmount=message.data.data.amount/100;IdeaApp.order.step3.loadCartSummary(true);}
if(message.data.event==="FORM_SUBMITTED"){iframeWin.css({"position":"fixed","width":"80%","height":"90%","top":"50%","left":"50%","transform":"translate(-50%, -50%)","z-index":"9999","box-shadow":"0 0 1000px 1000px rgba(0,0,0,0.5)","background-color":"#fff"});}}},false)},error:function(){IdeaApp.plugins.notification('Kredi kartı formu yüklenemedi. Lütfen daha sonra tekrar deneyiniz.','warning');IdeaApp.plugins.loading.remove(formSelector);}});},createOrder:function(){IdeaApp.helpers.ajaxRequest({url:'/order/ozan/create',data:{'anticsrf':anticsrf},success:function(){var submitButton=$('[data-selector="submit-button"]');submitButton.removeAttr('disabled').removeClass('btn-loading');}});},submitForm:function(submitButton){submitButton.addClass('btn-loading').attr('disabled','disabled');$.ajax({url:'/order/ozan/check',type:'POST',dataType:'json',async:false,data:{'anticsrf':$("input[name*='anticsrf']").val()},success:function(data,status,jqXhr){var iframeWin=document.getElementById('iFrameOzan');iframeWin.contentWindow.postMessage({event:"SUBMIT_FORM"},"*");},error:function(xhr,status){IdeaApp.plugins.notification(xhr.responseJSON.errorMessage,'warning');submitButton.removeAttr('disabled').removeClass('btn-loading');}})},},mailOrder:{binCache:null,init:function(){if($('#MailOrder').length==0){return;}
this.formValidate();this.eventListener();},formValidate:function(){$('#MailOrder [data-selector="payment-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',focusInvalid:false,rules:{mailorderid:{required:true},m_ccname:{required:true,creditCardName:true},creditCardNumber:{required:true,creditCardNumber:true},m_cvc2:{required:true},m_ccmonth:{required:true},m_ccyear:{required:true},m_cctype:{required:true}},messages:{mailorderid:{required:"Lütfen kredi kartı seçiniz."},m_ccname:{required:"Lütfen kart üzerindeki isim alanını giriniz.",creditCardName:"Lütfen kart üzerindeki isim alanını kontrol ediniz.",},creditCardNumber:{required:"Lütfen kredi kartı numarası giriniz.",creditCardNumber:"Lütfen geçerli kart numarası giriniz."},m_cvc2:{required:"CVC giriniz."},m_ccmonth:{required:"Ay seçiniz."},m_ccyear:{required:"Yıl seçiniz."},m_cctype:{required:"Kart tipini seçiniz."}},invalidHandler:function(form,validator){if(!validator.numberOfInvalids()){return;}
$('html, body').animate({scrollTop:$(validator.errorList[0].element).parents('.cart-block').offset().top-10},200);},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('creditCardName',function(value){return IdeaApp.helpers.checkCreditCardName(value);});$.validator.addMethod('creditCardNumber',function(value){return IdeaApp.helpers.checkCreditCardNumber(value);});$('#mailOrderNumber').payment('formatCardNumber');$('#mailOrderCvc').payment('formatCardCVC');},changePaymentGateway:function(element){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var selectedOption=element.find('option:selected');currentFormElement.find('.card-logo img').attr('src',selectedOption.attr('data-image-path'));IdeaApp.helpers.ajaxRequest({url:"/order/mail-order-installments",data:{'mailOrderId':selectedOption.val(),'anticsrf':anticsrf},success:function(response){$('[data-selector="mail-order-installments"]').html(response);IdeaApp.order.step3.loadCartSummary();}});},changeCardNumber:function(element){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var cartNumber=element.val().replace(/\s+/g,"");var binNumber=cartNumber.toString().substring(0,6);currentFormElement.find('.card-number').html(element.val());if(binNumber.length<6){this.binCache=null;currentFormElement.find('.card-type-logo img').addClass('d-none');}else if(binNumber.length==6&&binNumber!=this.binCache){this.binCache=binNumber;IdeaApp.plugins.loadingBar.show('body','no-overlay');IdeaApp.helpers.ajaxRequest({url:"/order/bin-check",data:{'bin_number':binNumber,'anticsrf':anticsrf},success:function(response){if(response.success){IdeaApp.order.step3.changeCardTypeLogo(response.data);}else{currentFormElement.find('.card-type-logo img').addClass('d-none');}
IdeaApp.plugins.loadingBar.hide();}});}},submitForm:function(submitButton){var installmentSelector=$('input[name="m_inst"]');if(installmentSelector.length==0){IdeaApp.plugins.notification('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.','warning');submitButton.removeAttr('disabled').removeClass('btn-loading');return;}
var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var mailOrderNumber=currentFormElement.find('#mailOrderNumber').val().replace(/\s+/g,"");$('input[name=m_ccno1]').val(mailOrderNumber.substr(0,4));$('input[name=m_ccno2]').val(mailOrderNumber.substr(4,4));$('input[name=m_ccno3]').val(mailOrderNumber.substr(8,4));$('input[name=m_ccno4]').val(mailOrderNumber.substr(12,4));currentFormElement.submit();},eventListener:function(){var self=this;$(document).on('click','input[name="m_inst"]',function(){IdeaApp.order.step3.loadCartSummary();});$(document).on('change','#mailOrderId',function(){self.changePaymentGateway($(this));});$('#mailOrderNumber').bind("input keyup mouseup keyup cut copy paste",function(){self.changeCardNumber($(this));});$(document).on('input keyup mouseup keyup cut copy paste','#mailOrderName',function(){IdeaApp.order.step3.changeCardName($(this));});$(document).on('change','#mailOrderMonth',function(){IdeaApp.order.step3.changeCardMonth($(this));});$(document).on('change','#mailOrderYear',function(){IdeaApp.order.step3.changeCardYear($(this));});$(document).on('input keyup mouseup keyup cut copy paste','#mailOrderCvc',function(){IdeaApp.order.step3.changeCardCvc($(this));});}},bkmExpress:{submitForm:function(submitButton){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();if(currentFormElement.attr("data-version")==1){currentFormElement.submit();return;}
IdeaApp.helpers.ajaxRequest({url:currentFormElement.attr('action'),data:currentFormElement.serialize(),success:function(response,status,xhr){if(xhr&&xhr.getResponseHeader('Content-Type')=='application/json'){window.location.href=response.redirect;return;}else{$('#bkm-express-container').html(response);}
var bkmInterval=setInterval(function(){$('#payment-dropin iframe').on('load',function(){submitButton.removeClass('btn-loading').removeAttr('disabled');clearInterval(bkmInterval);});},100);},error:function(xhr,status){submitButton.removeClass('btn-loading').removeAttr('disabled');IdeaApp.plugins.notification('BKM Express formu yüklenemedi. Lütfen daha sonra tekrar deneyiniz.','warning');}});}},moneyOrder:{init:function(){if($('#MoneyOrder').length==0){return;}
this.eventListener();},change:function(element){$('#MoneyOrder ul li').removeClass('active');element.parents('li').addClass('active');},eventListener:function(){var self=this;$(document).on('change','input[name="accselection"]',function(){self.change($(this));});}},customPayment:{init:function(){if($('#Custom').length==0){return;}
this.eventListener();},change:function(element){$('.special-payment span').html(250-element.val().length)},eventListener:function(){var self=this;$(document).on('keyup','[name="usernote"]',function(){self.change($(this));});}},agreement:{messages:{agreementMessage:'Lütfen sözleşmeyi onaylayın.'},init:function(){if(!this.check()){return;}
this.eventListener();},check:function(){if($('#agreement-content').length>0){return true;}
return false;},load:function(params){if(!this.check()){IdeaApp.plugins.loadingBar.hide();return;}
IdeaApp.helpers.ajaxRequest({data:params,url:"/order/view-agreements",success:function(response){if(response.success){$('[data-selector="notification"]').html(response.data.notification);$('[data-selector="sales"]').html(response.data.sales);}else{IdeaApp.plugins.notification(response.errorMessage,'warning');}
IdeaApp.plugins.loadingBar.hide();}});},toggle:function(element){var elementParent=element.parents('.agreement-container');if(elementParent.hasClass('active')){elementParent.removeClass('active');}else{elementParent.parents().find('.agreement-container').removeClass('active');elementParent.addClass('active');}},checkAgreement:function(element){if(element.length==0){return true;}
var currentForm=IdeaApp.order.step3.getCurrentFormElement();element.parent().find('label.validate-error').remove();if(element.is(':checked')){element.parent().removeClass('no-valid-agreement');currentForm.find('input[name="paymentAgreementOk"]').val('1');return true;}else{element.parent().addClass('no-valid-agreement').append('<label class="validate-error">'+this.messages.agreementMessage+'</label>');currentForm.find('input[name="paymentAgreementOk"]').val('0');return false;}},checkPersonalDataAgreement:function(element){if(element.length==0){return true;}
var currentForm=IdeaApp.order.step3.getCurrentFormElement();element.parent().find('label.validate-error').remove();if(element.is(':checked')){element.parent().removeClass('no-valid-agreement');currentForm.find('input[name="personalDataAgreementOk"]').val('1');return true;}else{element.parent().addClass('no-valid-agreement').append('<label class="validate-error">'+this.messages.agreementMessage+'</label>');currentForm.find('input[name="personalDataAgreementOk"]').val('0');return false;}},validAgreements:function(){if(!this.check()){return true;}
var agreementValid=this.checkAgreement($('[name="agreement"]'));var personalDataAgreementValid=this.checkPersonalDataAgreement($('[name="personalDataAgreement"]'));if(agreementValid&&personalDataAgreementValid){return true;}
return false;},eventListener:function(){var self=this;$(document).on('click','[data-selector="agreement-toggle"]',function(){self.toggle($(this));});$(document).on('change','[name="agreement"]',function(){self.checkAgreement($(this));});$(document).on('change','[name="personalDataAgreement"]',function(){self.checkPersonalDataAgreement($(this));});}},paymentTab:{init:function(){this.contentLoad();this.responsive();this.eventListener();},tab:function(element){if(element.hasClass('active')){return;}
var parentElement=element.parents('.payment-tab'),targetContent=element.attr('data-target');parentElement.find('#'+targetContent).addClass('active').siblings().removeClass('active');element.addClass('active').siblings().removeClass('active');parentElement.find('[data-target="'+targetContent+'"]').addClass('active').siblings().removeClass('active');parentElement.find('[data-selector="payment-tab-select"]').find('[data-target="'+targetContent+'"]').attr('selected',true);this.contentLoad();IdeaApp.order.step3.loadCartSummary();},tabSelect:function(element){var parentElement=element.parents('.payment-tab');var targetContent=element.find('option:selected').attr('data-target');var targetElement=parentElement.find('.payment-tab-nav-left').find('[data-target="'+targetContent+'"]');this.tab(targetElement);},mobileTab:function(element){var parentElement=element.parents('.payment-tab'),targetContent=element.attr('data-target');parentElement.find('#'+targetContent).addClass('active').siblings().removeClass('active');element.addClass('active').siblings().removeClass('active');parentElement.find('[data-target="'+targetContent+'"]').addClass('active').siblings().removeClass('active');parentElement.find('.payment-tab-nav-left').find('[data-target="'+targetContent+'"]').prependTo('.payment-tab-nav-left');parentElement.find('.payment-tab-nav-menu').find('[data-target="'+targetContent+'"]').prependTo('.payment-tab-nav-menu');parentElement.find('[data-selector="payment-tab-select"]').find('[data-target="'+targetContent+'"]').attr('selected',true);$('.payment-tab-nav-right').removeClass('toggle');this.responsive();this.contentLoad();IdeaApp.order.step3.loadCartSummary();},contentLoad:function(){var currentFormElement=IdeaApp.order.step3.getCurrentFormElement();var providerCode=IdeaApp.order.step3.getCurrentProviderCode();var activeTab=$('[data-selector="payment-tab"].active');$('[data-selector="payment-button-title"]').html('"'+activeTab.attr('data-payment-button-title')+'"');$('[data-selector="total-amount"]').html($('#cart-total-amount').html());$('[data-selector="submit-button"]').html('<i class="btn-'+providerCode+'"></i>'+activeTab.attr('data-payment-button-title')).removeClass().addClass('btn btn-block btn-primary btn-'+providerCode);if(currentFormElement.find('[name="paymentAgreementOk"]').val()=='1'){$('[name="agreement"]').prop('checked',true);}else{$('[name="agreement"]').prop('checked',false);}
if(currentFormElement.find('[name="personalDataAgreementOk"]').val()=='1'){$('[name="personalDataAgreement"]').prop('checked',true);}else{$('[name="personalDataAgreement"]').prop('checked',false);}
if(providerCode=='Iyzico'||providerCode=='PayWithIyzico'){IdeaApp.order.step3.iyzico.load();}else if(providerCode=='CreditCard'&&IdeaApp.order.step3.creditCard.masterpass.status){IdeaApp.order.step3.creditCard.masterpass.load();}else if(providerCode=='Ozan'){IdeaApp.order.step3.ozan.load();}},responsive:function(){var containerWidth=$('.payment-tab-nav').outerWidth(),totalWidth=0;$('.payment-tab-nav-left > div').each(function(index){totalWidth+=$(this).outerWidth();if(totalWidth+40>=containerWidth){$(this).addClass('mobile-item');$('.payment-tab-nav-menu > div:nth-child('+parseInt(index+1)+')').addClass('mobile-item');$('.payment-tab-nav-right').addClass('active');}else{$(this).removeClass('mobile-item');$('.payment-tab-nav-menu > div:nth-child('+parseInt(index+1)+')').removeClass('mobile-item');$('.payment-tab-nav-right').removeClass('active');}});},toggle:function(element){if(element.parent().hasClass('toggle')){element.parent().removeClass('toggle');}else{element.parent().addClass('toggle');}},eventListener:function(){var self=this;$(document).on('click','[data-selector="payment-tab"]',function(){self.tab($(this));});$(document).on('change','[data-selector="payment-tab-select"]',function(){self.tabSelect($(this));});$(document).on('click','[data-selector="payment-mobile-tab"]',function(){self.mobileTab($(this));});$(document).on('click','[data-selector="toggle-payment-tab-menu"]',function(){self.toggle($(this));});$(window).resize(function(){self.responsive();});$(document).click(function(event){var tabMenuElement=$('.payment-tab-nav-right');if(tabMenuElement.has(event.target).length===0){tabMenuElement.removeClass('toggle');}});}},stripe:{form:null,stripe:null,elements:null,cardName:null,cardNumber:null,cardExpiry:null,cardCvc:null,elementCardNumber:null,elementCardExpiry:null,elementCardCvc:null,error:null,init:function(){if($('[name="publishable_key"]').length){var self=this;this.form=document.getElementById('payment-form');this.error=document.getElementById('card-errors');this.stripe=Stripe($('[name="publishable_key"]').val());this.elements=this.stripe.elements();var elementStyles={base:{color:'#32325D',fontWeight:500,fontFamily:'Source Code Pro, Consolas, Menlo, monospace',fontSize:'16px',fontSmoothing:'antialiased','::placeholder':{color:'#CFD7DF',},':-webkit-autofill':{color:'#e39f48',},},invalid:{color:'#E25950','::placeholder':{color:'#FFCCA5',},},};var elementClasses={focus:'focused',empty:'empty',invalid:'invalid',};this.cardName=$('#cardName');this.cardName.on('keyup',function(){if($(this).val()!=''){self.cardName.removeClass('stripe-validate-error');}});this.cardNumber=this.elements.create('cardNumber',{showIcon:true,style:elementStyles,classes:elementClasses,placeholder:''});this.cardNumber.mount('#cardNumber');this.elementCardNumber=$('#cardNumber');this.cardNumber.on('focus',function(event){self.elementCardNumber.parent().addClass('active');});this.cardNumber.on('blur',function(event){if(!self.elementCardNumber.hasClass('invalid')&&!self.elementCardNumber.hasClass('StripeElement--complete')){self.elementCardNumber.parent().removeClass('active');}});this.cardNumber.on('change',function(event){self.elementCardNumber.removeClass('stripe-validate-error');if(event.error){self.error.textContent=event.error.message;}else{self.error.textContent='';}});this.cardExpiry=this.elements.create('cardExpiry',{style:elementStyles,classes:elementClasses,placeholder:''});this.cardExpiry.mount('#cardExpiry');this.elementCardExpiry=$('#cardExpiry');this.cardExpiry.on('focus',function(event){self.elementCardExpiry.parent().addClass('active');});this.cardExpiry.on('blur',function(event){if(!self.elementCardExpiry.hasClass('invalid')&&!self.elementCardExpiry.hasClass('StripeElement--complete')){self.elementCardExpiry.parent().removeClass('active');}});this.cardExpiry.on('change',function(event){self.elementCardExpiry.removeClass('stripe-validate-error');if(event.error){self.error.textContent=event.error.message;}else{self.error.textContent='';}});this.cardCvc=this.elements.create('cardCvc',{style:elementStyles,classes:elementClasses,placeholder:''});this.cardCvc.mount('#cardCvc');this.elementCardCvc=$('#cardCvc');this.cardCvc.on('focus',function(event){self.elementCardCvc.parent().addClass('active');});this.cardCvc.on('blur',function(event){if(!self.elementCardCvc.hasClass('invalid')&&!self.elementCardCvc.hasClass('StripeElement--complete')){self.elementCardCvc.parent().removeClass('active');}});this.cardCvc.on('change',function(event){self.elementCardCvc.removeClass('stripe-validate-error');if(event.error){self.error.textContent=event.error.message;}else{self.error.textContent='';}});}},submitForm:function(submitButton){if(this.valid()){this.createToken();}else{submitButton.removeClass('btn-loading');submitButton.prop('disabled',false);}},createToken:function(){var self=this;var options={name:document.getElementById('cardName').value,};this.stripe.createToken(this.cardNumber,options).then(function(result){if(result.error){self.error.textContent=response.error.messge;}else{self.stripeResponseHandler(result.token);}});},stripeResponseHandler:function(token){var hiddenInput=document.createElement('input');hiddenInput.setAttribute('type','hidden');hiddenInput.setAttribute('name','stripeToken');hiddenInput.setAttribute('value',token.id);this.form.appendChild(hiddenInput);this.form.submit();},valid:function(){var i=0;if(this.cardName.val()==''){this.cardName.addClass('stripe-validate-error');i++;}
if(!this.elementCardNumber.hasClass('StripeElement--complete')){this.elementCardNumber.addClass('stripe-validate-error');i++;}else{this.elementCardNumber.removeClass('stripe-validate-error');}
if(!this.elementCardExpiry.hasClass('StripeElement--complete')){this.elementCardExpiry.addClass('stripe-validate-error');i++;}else{this.elementCardExpiry.removeClass('stripe-validate-error');}
if(!this.elementCardCvc.hasClass('StripeElement--complete')){this.elementCardCvc.addClass('stripe-validate-error');i++;}else{this.elementCardCvc.removeClass('stripe-validate-error');}
return(i===0?true:false);}},eventListener:function(){var self=this;$(document).on('click','.address-edit-button',function(){self.showEditAddressDialog($(this));});$(document).on('click','[data-selector="submit-button"]',function(){self.paymentFormSubmit();});}},success:{init:function(){this.fastSignupFormValidate();this.checkAndShowMasterpassModal();this.eventListener();},fastSignupFormValidate:function(){$('#fastSignupForm').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',focusInvalid:false,rules:{password:{required:true,minlength:6,regex:/^(?=.*[0-9])(?=.*[a-zA-Z])[a-zA-Z0-9!\.@#$%&]{6,16}$/,},memberAgreement:{required:true},personalDataAgreement:{required:true}},messages:{password:{required:"Lütfen şifre belirtiniz.",minlength:"Şifre en az 6 haneli olmalıdır.",regex:"Şifre uzunluğu en az 6 hane sadece harf ve rakamdan oluşmalıdır."},memberAgreement:{required:"Lütfen üyelik sözleşmesini kabul edin."},personalDataAgreement:{required:"Lütfen kişisel verileri koruma kanununu kabul edin."}},errorPlacement:function(error,element){if($("div.validate-error").length==0){element.parents('.cart-block').eq(0).append(error).addClass('cart-block-error');}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('regex',function(value,element,regexp){return IdeaApp.helpers.checkRegex(value,element,regexp)});},checkAndShowMasterpassModal:function(){if($('#masterpass-success').length==0){return;}
$.fancybox.open({src:'#masterpass-success',touch:false});},submitFastSignupForm:function(submitButton){var formElement=$("#fastSignupForm");if(!formElement.valid()){return;}
submitButton.attr('disabled','disabled').addClass('btn-loading');IdeaApp.helpers.ajaxRequest({url:'/hizli-uye-ol?hash='+formElement.attr('data-order-hash'),data:formElement.serialize(),success:function(response){if(response.success){IdeaApp.plugins.notification(response.data.message,'confirmation');$('.order-fast-signup').fadeOut(300);}else{IdeaApp.plugins.notification(response.errorMessage,'warning');submitButton.removeAttr('disabled').removeClass('btn-loading');}}});},changeMemberPassword:function(element){$('div.validate-error').remove();if(element.val().length>3){$('[data-selector="fast-signup-checkbox-groups"]').fadeIn().removeClass('d-none');}else{$('[data-selector="fast-signup-checkbox-groups"]').fadeOut().addClass('d-none');}},printOrder:function(element){var url='/order/printOrder?hash='+element.attr('data-order-hash');IdeaApp.helpers.print(element,url);},checkFastSignupForm:function(){$('div.validate-error').remove();if(!$('#fastSignupForm').valid()){return;}
$('.order-fast-signup').removeClass('cart-block-error');},showMemberAgreement:function(){$.fancybox.open({src:'#user-agreement-content'});},showPersonalDataAgreement:function(){$.fancybox.open({src:'#personal-data-agreement-content'});},showPassword:function(element){if(element.hasClass('fa-eye-slash')){element.removeClass('fa-eye-slash').addClass('fa-eye');$('input[name="password"]').attr('type','text');}else{element.removeClass('fa-eye').addClass('fa-eye-slash');$('input[name="password"]').attr('type','password');}},eventListener:function(){var self=this;$(document).on('click','[data-selector="submit-signup-form"]',function(e){e.preventDefault();self.submitFastSignupForm($(this));});$('input[name="password"]').keyup(function(){self.changeMemberPassword($(this));});$(document).on('click','[data-selector="print-order"]',function(){self.printOrder($(this));});$(document).on('change','[name="memberAgreement"], [name="personalDataAgreement"]',function(){self.checkFastSignupForm();});$(document).on('click','[data-selector="show-member-agreement"]',function(){self.showMemberAgreement();});$(document).on('click','[data-selector="show-personal-data-agreement"]',function(){self.showPersonalDataAgreement();});$(document).on('click','.password-icon',function(){self.showPassword($(this));});}},bankTransfer:{init:function(){this.validateForm();this.eventListener();},validateForm:function(){$('[data-selector="bank-transfer-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{refno:{required:true,refno:{depends:function(){$(this).val($.trim($(this).val()));}},},payment_gateway_id:{required:true},info:{required:false,minlength:5,maxlength:150}},messages:{refno:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] input[name="refno"]')+" giriniz.",},payment_gateway_id:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] select[name="payment_gateway_id"]')+" seçiniz.",},info:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] textarea[name="info"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] textarea[name="info"]')+" en az 5 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] textarea[name="info"]')+" en fazla 150 karakter olmalıdır."}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});},eventListener:function(){$(document).on('click','[data-selector="bank-transfer-form-button"]',function(){var bankTransferForm=$('[data-selector="bank-transfer-form"]');if(bankTransferForm.valid()){$(this).addClass('btn-loading');}});}},eventListener:function(){var self=this;$(document).on('focus','select, input, textarea',function(){self.customPlaceholder.click($(this));});$(document).on('blur','select, input, textarea',function(){$(this).parents('.custom-placeholder').removeClass('active');});$(document).on('click',function(event){self.customPlaceholder.removeClass(event,'custom-placeholder');});$(document).on('change keyup cut paste','.custom-placeholder select, .custom-placeholder input, .textarea-placeholder textarea',function(){self.customPlaceholder.focus($(this));});$(document).on('click','[data-selector="toggle-cart-items"]',function(){self.toggleCartItems($(this));});$(document).on('click','[data-selector="return-cart-page"]',function(){self.returnCartPage();});}}}($,window));function iyzicoEventBeforePayment(){if(!IdeaApp.order.step3.iyzico.isReadyToSubmit()){IdeaApp.plugins.notification('Iyzico servislerine bağlanılamadı. Lütfen daha sonra tekrar deneyiniz.','error');var submitButton=$('[data-selector="submit-button"]');submitButton.removeClass('btn-loading').removeAttr('disabled','disabled');setTimeout(function(){window.location.reload();},5000);throw 'stop';}}
function iyzicoEventOnChangeInstallment(paymentDetails){$('[data-selector="total-amount"]').html($('[for=installment-'+paymentDetails.installmentNumber+'] > div:last').html());$('#totalAmount').html($('[for=installment-'+paymentDetails.installmentNumber+'] > div:last').html());IdeaApp.order.step3.iyzico.installment=paymentDetails.installmentNumber;IdeaApp.order.step3.iyzico.installmentAmount=paymentDetails.installmentPrice;IdeaApp.order.step3.iyzico.totalAmount=paymentDetails.totalPrice;IdeaApp.order.step3.loadCartSummary(true);}
function iyzicoEventWhenErrorOccured(error){IdeaApp.plugins.notification(error,'error');var submitButton=$('[data-selector="submit-button"]');submitButton.removeClass('btn-loading').removeAttr('disabled','disabled');}
function reCaptchaPaymentSubmit(token){var activeForm=$('.payment-tab-content #'+$('[data-selector="payment-tab"].active').attr('data-target')).find('[data-selector="payment-form"]');activeForm.append("<input name='recaptcha' type='hidden' value='"+token+"'>");activeForm.submit();}