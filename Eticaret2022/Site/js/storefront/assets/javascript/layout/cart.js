;(function($,w){'use strict';if(!w.jQuery){throw 'Ideasoft: jQuery not found';}
w.IdeaApp[IdeaApp.helpers.getRouteGroup()]={init:function(){this.promotion.init();this.coupon.init();this.eventListener();},deleteCartItem:function(element){var self=this;IdeaApp.plugins.loadingBar.show();var postRemove=IdeaCart.listeners.postRemove;IdeaCart.listeners.postRemove=function(element,response){if(response.success){self.updateCartContent();}
postRemove(element,response);IdeaCart.listeners.postRemove=postRemove;};IdeaCart.deleteItem(element,element.attr('data-id'));},updateCartItem:function(element,cartItemId,quantity){var self=this;IdeaApp.plugins.loadingBar.show();var postUpdate=IdeaCart.listeners.postUpdate;IdeaCart.listeners.postUpdate=function(element,response){if(response.success){self.updateCartContent();}
postUpdate(element,response);IdeaCart.listeners.postUpdate=postUpdate;};IdeaCart.updateItem(element,cartItemId,quantity);},changeQuantity:function(qtyElement){this.updateCartItem(qtyElement,qtyElement.attr('data-id'),qtyElement.val());},updateCartContent:function(callback){IdeaApp.helpers.ajaxRequest({url:'/sepet',success:function(response){$('#cart-container').html(response);$('[data-toggle="tooltip"]').tooltip();IdeaApp.plugins.loadingBar.hide();if(callback){callback();}}});},promotion:{init:function(){this.eventListener();},toggle:function(element){if(element.hasClass('active')){element.removeClass('active');}else{element.addClass('active');}},select:function(element){var self=this;var promotionId=parseInt(element.attr('data-promotion-id'));var params={'promotion_id':promotionId,'anticsrf':anticsrf};IdeaApp.plugins.loadingBar.show();if(promotionId===0){IdeaApp.helpers.ajaxRequest({url:'/cart/remove_promotion',data:params,success:function(response){if(response.success){IdeaApp.cart.updateCartContent();}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});}else{IdeaApp.helpers.ajaxRequest({url:'/promotion/selectPromotionFromCart',data:params,success:function(response){if(response.success){if(response.data.message!==''){IdeaApp.plugins.notification(response.data.message,'warning');}
if(response.data.promoted_products.length>0){self.showPromotedProducts();}
IdeaApp.cart.updateCartContent();}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});}},showPromotedProductVariants:function(element){var productId=element.attr('data-product-id');$('.promotional-product-variants[data-product-id="'+productId+'"]').toggle();},showPromotedProducts:function(){var self=this;$.fancybox.open({src:'/cart/get_promoted_products',type:'ajax',afterShow:function(){self.setTableWidths();}});},setTableWidths:function(){$('.promotional-product-variants-overflow td').each(function(){if($(this).hasClass('promotion-product-button')){return;}
var thisClass=$(this).attr('class');var parentsWidth=$(this).parents('.promotional-product-table').find('thead').find('.'+thisClass).outerWidth();$(this).outerWidth(parentsWidth);});},addPromotedProduct:function(element){var postPersist=IdeaCart.listeners.postPersist;IdeaCart.listeners.postPersist=function(element,response){if(response.success){var openedParentPromotedProductIds=[];$('[data-selector="show-promoted-product-variants"]').each(function(){if($(this).parents('.promotion-option-product ').next().is(":visible")){openedParentPromotedProductIds.push($(this).attr('data-product-id'));}});IdeaApp.cart.updateCartContent(function(){IdeaApp.helpers.ajaxRequest({url:'/cart/get_promoted_products',success:function(response){$('#promotion-product').parent().html(response);setTimeout(function(){if($('[data-type="promoted-product"]').length==0){$.fancybox.close();return;}
for(var i=0;i<openedParentPromotedProductIds.length;i++){$('.promotion-product-button > [data-product-id="'+openedParentPromotedProductIds[i]+'"]').parents('tr').next('.promotional-product-variants').css('display','table-row');}},10);}});});}
postPersist(element,response);IdeaCart.listeners.postPersist=postPersist;};var postParams={};postParams.anticsrf=anticsrf;postParams.productId=element.attr('data-product-id');postParams.quantity=1;IdeaCart.addItem(element,postParams);},eventListener:function(){var self=this;$(document).on('click','.promotion-list',function(){self.toggle($(this));});$(document).on('click','.list-content li',function(){self.select($(this));});$(document).on('click','[data-selector="show-promoted-products"]',function(){self.showPromotedProducts();});$(document).on('click','[data-selector="show-promoted-product-variants"]',function(){self.showPromotedProductVariants($(this));});$(document).on('click','[data-selector="add-promoted-product"]',function(){self.addPromotedProduct($(this));});$(document).click(function(event){var promotionListElement=$('.promotion-list');if(promotionListElement.has(event.target).length===0){if(promotionListElement.hasClass('active')){promotionListElement.removeClass('active');}}});}},coupon:{init:function(){this.formValidate();this.eventListener();},formValidate:function(){$('#couponCodeForm').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{couponCode:{minlength:3}},messages:{couponCode:{minlength:"Çek kodu min 3 karakter olmalıdır."}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});},toggle:function(element){if(element.is(':checked')){$('.coupon-code-wrapper').stop().slideDown();}else{$('.coupon-code-wrapper').stop().slideUp();}},changeValue:function(){if(!$('#couponCodeForm').valid()){$('[data-selector="submit-coupon-code"]').attr('disabled','disabled');}else{$('[data-selector="submit-coupon-code"]').removeAttr('disabled');}},submitForm:function(event){event.preventDefault();if(!$('#couponCodeForm').valid()){return;}
IdeaApp.plugins.loadingBar.show();IdeaApp.helpers.ajaxRequest({url:'/hediye-ceki-kullan',data:{'code':$('[name="couponCode"]').val(),'anticsrf':anticsrf},success:function(response){if(!response.success){IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();return;}
if(response.data.message!==''){IdeaApp.plugins.notification(response.data.message,'warning');}
IdeaApp.cart.updateCartContent();}});},eventListener:function(){var self=this;$(document).on('click','#useCouponCode',function(){self.toggle($(this));});$(document).on('keyup copy paste cut','[name="couponCode"]',function(){self.changeValue();});$(document).on('click','[data-selector="submit-coupon-code"]',function(event){self.submitForm(event);});}},eventListener:function(){var self=this;$(document).on('click','#cart-container [data-selector="delete-cart-item"]',function(){self.deleteCartItem($(this));});$(document).on('click','#cart-container [data-selector="increase-qty"], #cart-container [data-selector="decrease-qty"]',function(){var qtyElement=$(this).parents('[data-selector="qty-wrapper"]').find('[data-selector="qty"]');self.changeQuantity(qtyElement);});}}}(jQuery,window));